
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Mutation Analysis &#8212; The Fuzzing Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=42e1b1a5" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'MutationAnalysis';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fuzzing with Grammars" href="Grammars.html" />
    <link rel="prev" title="Search-Based Fuzzing" href="SearchBasedFuzzer.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of fuzzingbook.org, currently in development. See the <a href="https://fuzzingbook.org/"  style="color:white!important;">classic site</a> for resources.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/fuzzingbook.png" class="logo__image only-light" alt="The Fuzzing Book - Home"/>
    <script>document.write(`<img src="_static/fuzzingbook.png" class="logo__image only-dark" alt="The Fuzzing Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Fuzzing Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Tours through the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Testing.html">Introduction to Software Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lexical Fuzzing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Fuzzer.html">Fuzzing: Breaking Things with Random Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Coverage.html">Code Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="MutationFuzzer.html">Mutation-Based Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GreyboxFuzzer.html">Greybox Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="SearchBasedFuzzer.html">Search-Based Fuzzing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Mutation Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Syntactical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Grammars.html">Fuzzing with Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarFuzzer.html">Efficient Grammar Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarCoverageFuzzer.html">Grammar Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parser.html">Parsing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProbabilisticGrammarFuzzer.html">Probabilistic Grammar Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeneratorGrammarFuzzer.html">Fuzzing with Generators</a></li>

<li class="toctree-l1"><a class="reference internal" href="GreyboxGrammarFuzzer.html">Greybox Fuzzing with Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reducer.html">Reducing Failure-Inducing Inputs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semantical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FuzzingWithConstraints.html">Fuzzing with Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarMiner.html">Mining Input Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="InformationFlow.html">Tracking Information Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConcolicFuzzer.html">Concolic Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="SymbolicFuzzer.html">Symbolic Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Domain-Specific Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ConfigurationFuzzer.html">Testing Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="APIFuzzer.html">Fuzzing APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carver.html">Carving Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="PythonFuzzer.html">Testing Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebFuzzer.html">Testing Web Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUIFuzzer.html">Testing Graphical User Interfaces</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Managing Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FuzzingInTheLarge.html">Fuzzing in the Large</a></li>
<li class="toctree-l1"><a class="reference internal" href="WhenToStopFuzzing.html">When To Stop Fuzzing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AcademicPrototyping.html">Academic Prototyping</a></li>
<li class="toctree-l1"><a class="reference internal" href="PrototypingWithPython.html">Prototyping with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="RailroadDiagrams.html">Railroad Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="ControlFlow.html">Control Flow Graph</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Fuzzingbook Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Using Fuzzingbook Code in your own Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?urlpath=tree/docs/notebooks/MutationAnalysis.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/fuzzingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/fuzzingbook/issues/new?title=Issue%20on%20page%20%2FMutationAnalysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/MutationAnalysis.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Mutation Analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-structural-coverage-is-not-enough">Why Structural Coverage is Not Enough</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seeding-artificial-faults-with-mutation-analysis">Seeding Artificial Faults with Mutation Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structural-coverage-adequacy-by-example">Structural Coverage Adequacy by Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#injecting-artificial-faults">Injecting Artificial Faults</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutating-python-code">Mutating Python Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-mutator-for-functions">A Simple Mutator for Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-mutations">Evaluating Mutations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutator-for-modules-and-test-suites">Mutator for Modules and Test Suites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-equivalent-mutants">The Problem of  Equivalent Mutants</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-estimation-of-number-of-equivalent-mutants">Statistical Estimation of Number of Equivalent Mutants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-estimation-of-the-number-of-immortals-by-chaos-estimator">Statistical Estimation of the Number of Immortals by Chao’s Estimator</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-arithmetic-expression-mutators">Exercise 1: Arithmetic Expression Mutators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-optimizing-mutation-analysis">Exercise 2: Optimizing Mutation Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-byte-code-mutator">Exercise 3: Byte Code Mutator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-estimating-residual-defect-density">Exercise 4: Estimating Residual Defect Density</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="mutation-analysis">
<h1>Mutation Analysis<a class="headerlink" href="#mutation-analysis" title="Link to this heading">#</a></h1>
<p>In the <a class="reference internal" href="Coverage.html"><span class="std std-doc">chapter on coverage</span></a>, we showed how one can identify which parts of the program are executed by a program, and hence get a sense of the effectiveness of a set of test cases in covering the program structure.  However, coverage alone may not be the best measure for the effectiveness of a test, as one can have great coverage without ever checking a result for correctness.  In this chapter, we introduce another means for assessing the effectiveness of a test suite: After injecting <em>mutations</em> – <em>artificial faults</em> – into the code, we check whether a test suite can detect these artificial faults.  The idea is that if it fails to detect such mutations, it will also miss real bugs.</p>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>You need some understanding of how a program is executed.</p></li>
<li><p>You should have read <a class="reference internal" href="Coverage.html"><span class="std std-doc">the chapter on coverage</span></a>.</p></li>
</ul>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<!-- Automatically generated. Do not edit. -->
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fuzzingbook.MutationAnalysis</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p>This chapter introduces two methods of running <em>mutation analysis</em> on subject programs. The first class <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> targets individual functions. Given a function <code class="docutils literal notranslate"><span class="pre">gcd</span></code> and two test cases evaluate, one can run mutation analysis on the test cases as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">gcd</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Minimal&quot;</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mirror&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
<span class="go">-&gt;	gcd_1</span>
<span class="go">&lt;-	gcd_1</span>
<span class="go">Detected gcd_1 &lt;class &#39;UnboundLocalError&#39;&gt; cannot access local variable &#39;c&#39; where it is not associated with a value</span>

<span class="go">-&gt;	gcd_2</span>
<span class="go">&lt;-	gcd_2</span>
<span class="go">Detected gcd_2 &lt;class &#39;AssertionError&#39;&gt; Mirror</span>

<span class="go">-&gt;	gcd_3</span>
<span class="go">&lt;-	gcd_3</span>

<span class="go">-&gt;	gcd_4</span>
<span class="go">&lt;-	gcd_4</span>

<span class="go">-&gt;	gcd_5</span>
<span class="go">&lt;-	gcd_5</span>

<span class="go">-&gt;	gcd_6</span>
<span class="go">&lt;-	gcd_6</span>

<span class="go">-&gt;	gcd_7</span>
<span class="go">&lt;-	gcd_7</span>
<span class="go">Detected gcd_7 &lt;class &#39;AssertionError&#39;&gt; Minimal</span>


<span class="go">0.42857142857142855</span>
</pre></div>
</div>
<p>The second class <code class="docutils literal notranslate"><span class="pre">MuProgramAnalyzer</span></code> targets standalone programs with test suites. Given a program <code class="docutils literal notranslate"><span class="pre">gcd</span></code> whose source code is provided in <code class="docutils literal notranslate"><span class="pre">gcd_src</span></code> and the test suite is provided by <code class="docutils literal notranslate"><span class="pre">TestGCD</span></code>, one can evaluate the mutation score of <code class="docutils literal notranslate"><span class="pre">TestGCD</span></code> as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">TestGCD</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">def</span> <span class="nf">test_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;gcd&#39;</span><span class="p">,</span> <span class="n">gcd_src</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">mutant</span><span class="p">[</span><span class="n">test_module</span><span class="p">]</span><span class="o">.</span><span class="n">runTest</span><span class="p">(</span><span class="s1">&#39;TestGCD&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
<span class="go">======================================================================</span>
<span class="go">FAIL: test_simple (__main__.TestGCD.test_simple)</span>
<span class="go">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="gr">----------------------------------------------------------------------</span>
<span class="gr">Ran 1 test in 0.000s</span>

<span class="gr">FAILED (failures=1)</span>
<span class="gr">======================================================================</span>
<span class="gr">FAIL</span>: <span class="n">test_simple (__main__.TestGCD.test_simple)</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="gr">----------------------------------------------------------------------</span>
<span class="gr">Ran 1 test in 0.000s</span>

<span class="gr">FAILED (failures=1)</span>
<span class="gr">======================================================================</span>
<span class="gr">FAIL</span>: <span class="n">test_simple (__main__.TestGCD.test_simple)</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="gr">----------------------------------------------------------------------</span>
<span class="gr">Ran 1 test in 0.000s</span>

<span class="gr">FAILED (failures=1)</span>
<span class="gr">======================================================================</span>
<span class="gr">FAIL</span>: <span class="n">test_simple (__main__.TestGCD.test_simple)</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="gr">----------------------------------------------------------------------</span>
<span class="gr">Ran 1 test in 0.000s</span>

<span class="gr">FAILED (failures=1)</span>
<span class="gr">======================================================================</span>
<span class="gr">FAIL</span>: <span class="n">test_simple (__main__.TestGCD.test_simple)</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="gr">----------------------------------------------------------------------</span>
<span class="gr">Ran 1 test in 0.000s</span>

<span class="gr">FAILED (failures=1)</span>
<span class="gr">======================================================================</span>
<span class="gr">FAIL</span>: <span class="n">test_simple (__main__.TestGCD.test_simple)</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="gr">----------------------------------------------------------------------</span>
<span class="gr">Ran 1 test in 0.000s</span>

<span class="gr">FAILED (failures=1)</span>
<span class="gr">======================================================================</span>
<span class="gr">FAIL</span>: <span class="n">test_simple (__main__.TestGCD.test_simple)</span>
<span class="x">----------------------------------------------------------------------</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;</span>, line <span class="m">3</span>, in <span class="n">test_simple</span>
<span class="w">    </span><span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="w">           </span><span class="pm">^^^^^^^^^^^^^^^^^^</span>
<span class="gr">AssertionError</span>

<span class="x">----------------------------------------------------------------------</span>
<span class="x">Ran 1 test in 0.000s</span>

<span class="x">FAILED (failures=1)</span>

<span class="x">1.0</span>
</pre></div>
</div>
<p>The mutation score thus obtained is a better indicator of the quality of a given test suite than pure coverage.</p>
</section>
<section id="why-structural-coverage-is-not-enough">
<h2>Why Structural Coverage is Not Enough<a class="headerlink" href="#why-structural-coverage-is-not-enough" title="Link to this heading">#</a></h2>
<p>One of the problems with <a class="reference internal" href="Coverage.html"><span class="std std-doc">structural coverage</span></a> measures is that it fails to check whether the program executions generated by the test suite were actually <em>correct</em>. That is, an execution that produces a wrong output that is unnoticed by the test suite is counted exactly the same as an execution that produces the right output for coverage. Indeed, if one deletes the assertions in a typical test case, the coverage would not change for the new test suite, but the new test suite is much less useful than the original one.  As an example, consider this “test”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ineffective_test_1</span><span class="p">():</span>
    <span class="n">execute_the_program_as_a_whole</span><span class="p">()</span>
    <span class="k">assert</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>The final assertion here will always pass, no matter what <code class="docutils literal notranslate"><span class="pre">execute_the_program_as_a_whole()</span></code> will do.  Okay, if <code class="docutils literal notranslate"><span class="pre">execute_the_program_as_a_whole()</span></code> raises an exception, the test will fail, but we can also get around that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ineffective_test_2</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">execute_the_program_as_a_whole</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">assert</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>The problem with these “tests”, however, is that <code class="docutils literal notranslate"><span class="pre">execute_the_program_as_a_whole()</span></code> may achieve 100% code coverage (or 100% of any other structural coverage metric).  Yet, this number of 100% does not reflect the ability of the test to discover bugs, which actually is 0%.</p>
<p>This is indeed, not an optimal state of affairs. How can we verify that our tests are actually useful? One alternative (hinted in the chapter on coverage) is to inject bugs into the program, and evaluate the effectiveness of test suites in catching these injected bugs. However, that introduces another problem. How do we produce these bugs in the first place? Any manual effort is likely to be biased by the preconceptions of the developer as to where the bugs are likely to occur, and what effect it would have. Further, writing good bugs is likely to take a significant amount of time, for a very indirect benefit. Hence, such a solution is not sufficient.</p>
</section>
<section id="seeding-artificial-faults-with-mutation-analysis">
<h2>Seeding Artificial Faults with Mutation Analysis<a class="headerlink" href="#seeding-artificial-faults-with-mutation-analysis" title="Link to this heading">#</a></h2>
<p>Mutation Analysis offers an alternative solution to assess the effectiveness of a test suite.  The idea of mutation analysis is to seed <em>artificial faults</em>, known as <em>mutations</em>, into the program code, and to check whether the test suite finds them.  Such a mutation could, for instance, replace a <code class="docutils literal notranslate"><span class="pre">+</span></code> by a <code class="docutils literal notranslate"><span class="pre">-</span></code> somewhere within <code class="docutils literal notranslate"><span class="pre">execute_the_program_as_a_whole()</span></code>.  Of course, the above ineffective tests would not detect this, as they do not check any of the results.  An effective test would, however; and the assumption is that the more effective a test is in finding <em>artificial</em> faults, the more effective it would be in finding <em>real</em> faults.</p>
<p>The insight from Mutation Analysis is to consider the probability of insertion of a bug from the perspective of a programmer. If one assumes that the attention received by each program element in the program is sufficiently similar, one can further assume that each token in the program has a similar probability of being incorrectly transcribed. Of course, the programmer will correct any mistakes that gets detected by the compilers (or other static analysis tools). So the set of valid tokens different from the original that make it past the compilation stage is considered to be its possible set of <em>mutations</em> that represent the <em>probable faults</em> in the program. A test suite is then judged by its capability to detect (and hence prevent) such mutations. The proportion of such mutants detected over all <em>valid</em> mutants produced is taken as the mutation score. In this chapter, we see how one can implement Mutation Analysis in Python programs. The mutation score obtained represents the ability of any program analysis tools to prevent faults, and can be used to judge static test suites, test generators such as fuzzers, and also static and symbolic execution frameworks.</p>
<p>It might be intuitive to consider a slightly different perspective. A test suite is a program that can be considered to accept as its input, the program to be tested.  What is the best way to evaluate such a program (the test suite)? We can essentially <em>fuzz</em> the test suite by applying small mutations to the input program, and verifying that the test suite in question does not produce unexpected behaviors. The test suite is supposed to only allow the original through; and hence any mutant that is not detected as faulty represents a bug in the test suite.</p>
</section>
<section id="structural-coverage-adequacy-by-example">
<h2>Structural Coverage Adequacy by Example<a class="headerlink" href="#structural-coverage-adequacy-by-example" title="Link to this heading">#</a></h2>
<p>Let us introduce a more detailed example to illustrate both the problems with coverage as well as how mutation analysis works.  The <code class="docutils literal notranslate"><span class="pre">triangle()</span></code> program below classifies a triangle with edge lengths <span class="math notranslate nohighlight">\(a\)</span>, <span class="math notranslate nohighlight">\(b\)</span>, and <span class="math notranslate nohighlight">\(c\)</span> into the proper triangle category.  We want to verify that the program works correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">triangle</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Equilateral&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Isosceles&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Isosceles&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Isosceles&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Scalene&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Here are a few test cases to ensure that the program works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">strong_oracle</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Equilateral&#39;</span>

    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Isosceles&#39;</span>
    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Isosceles&#39;</span>
    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Isosceles&#39;</span>

    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Scalene&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Running them actually causes all tests to pass.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strong_oracle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>However, the statement that “all tests pass” has value only if we know that our tests are effective.
What is the effectiveness of our test suite? As we saw in the <a class="reference internal" href="Coverage.html"><span class="std std-doc">chapter on coverage</span></a>, one can use structural coverage techniques such as statement coverage to obtain a measure of effectiveness of the test case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Coverage</span> <span class="kn">import</span> <span class="n">Coverage</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">inspect</span>
</pre></div>
</div>
</div>
</div>
<p>We add a function <code class="docutils literal notranslate"><span class="pre">show_coverage()</span></code> to visualize the coverage obtained.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">VisualCoverage</span><span class="p">(</span><span class="n">Coverage</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">show_coverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">covered</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">lineno</span> <span class="k">for</span> <span class="n">method</span><span class="p">,</span>
                       <span class="n">lineno</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="n">name</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%2d</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">covered</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">VisualCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">strong_oracle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span><span class="o">.</span><span class="n">show_coverage</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   1: def triangle(a, b, c):
#  2:     if a == b:
#  3:         if b == c:
#  4:             return &#39;Equilateral&#39;
   5:         else:
#  6:             return &#39;Isosceles&#39;
   7:     else:
#  8:         if b == c:
#  9:             return &quot;Isosceles&quot;
  10:         else:
# 11:             if a == c:
# 12:                 return &quot;Isosceles&quot;
  13:             else:
# 14:                 return &quot;Scalene&quot;
  15: 
</pre></div>
</div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code> seems to have adequately covered all possible conditions.
That is, our set of test cases is reasonably good according to structural coverage. However, does the coverage obtained tell the whole story? Consider this test suite instead:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">weak_oracle</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Equilateral&#39;</span>

    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>
    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>
    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>

    <span class="k">assert</span> <span class="n">fn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>All that we are checking here is that a triangle with unequal sides is not equilateral. What is the coverage obtained?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">VisualCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">weak_oracle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span><span class="o">.</span><span class="n">show_coverage</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   1: def triangle(a, b, c):
#  2:     if a == b:
#  3:         if b == c:
#  4:             return &#39;Equilateral&#39;
   5:         else:
#  6:             return &#39;Isosceles&#39;
   7:     else:
#  8:         if b == c:
#  9:             return &quot;Isosceles&quot;
  10:         else:
# 11:             if a == c:
# 12:                 return &quot;Isosceles&quot;
  13:             else:
# 14:                 return &quot;Scalene&quot;
  15: 
</pre></div>
</div>
</div>
</div>
<p>Indeed, there does not seem to be <em>any</em> difference in coverage.
The <code class="docutils literal notranslate"><span class="pre">weak_oracle()</span></code> obtains exactly the same coverage as that of <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code>. However, a moment’s reflection should convince one that the <code class="docutils literal notranslate"><span class="pre">weak_oracle()</span></code> is not as effective as <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code>. However, <em>coverage</em> is unable to distinguish between the two test suites. What are we missing in coverage?
The problem here is that coverage is unable to evaluate the <em>quality</em> of our assertions. Indeed, coverage does not care about assertions at all. However, as we saw above, assertions are an extremely important part of test suite effectiveness. Hence, what we need is a way to evaluate the quality of assertions.</p>
</section>
<section id="injecting-artificial-faults">
<h2>Injecting Artificial Faults<a class="headerlink" href="#injecting-artificial-faults" title="Link to this heading">#</a></h2>
<p>Notice that in the <a class="reference internal" href="Coverage.html"><span class="std std-doc">chapter on coverage</span></a>, coverage was presented as a <em>proxy</em> for the likelihood of a test suite to uncover bugs. What if we actually try to evaluate the likelihood of a test suite to uncover bugs? All we need is to inject bugs into the program, one at a time, and count the number of such bugs that our test suite detects. The frequency of detection will provide us with the actual likelihood of the test suite to uncover bugs. This technique is called <em>fault injection</em>. Here is an example for <em>fault injection</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">triangle_m1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Equilateral&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return &#39;Isosceles&#39;</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># &lt;-- injected fault</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Isosceles&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Isosceles&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Scalene&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Let us see if our test suites are good enough to catch this fault. We first check whether <code class="docutils literal notranslate"><span class="pre">weak_oracle()</span></code> can detect this change.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ExpectError</span> <span class="kn">import</span> <span class="n">ExpectError</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">weak_oracle</span><span class="p">(</span><span class="n">triangle_m1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">weak_oracle()</span></code> is unable to detect any changes. What about our <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code>?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ExpectError</span><span class="p">():</span>
    <span class="n">strong_oracle</span><span class="p">(</span><span class="n">triangle_m1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/3191755624.py&quot;, line 2, in &lt;module&gt;
    strong_oracle(triangle_m1)
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/566939880.py&quot;, line 5, in strong_oracle
    assert fn(2, 2, 1) == &#39;Isosceles&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError (expected)
</pre></div>
</div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code> is able to detect this fault, which is evidence that <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code> is probably a better test suite.</p>
<p><em>Fault injection</em> can provide a good measure of effectiveness of a test suite, provided we have a list of possible faults. The problem is that collecting such a set of <em>unbiased</em> faults is rather expensive. It is difficult to create good faults that are reasonably hard to detect, and it is a manual process. Given that it is a manual process, the generated faults will be biased by the preconceptions of the developer who creates it. Even when such curated faults are available, they are unlikely to be exhaustive, and likely to miss important classes of bugs, and parts of the program. Hence, <em>fault injection</em> is an insufficient replacement for coverage. Can we do better?</p>
<p>Mutation Analysis provides an alternative to a curated set of faults. The key insight is that, if one assumes that the programmer understands the program in question, the majority of errors made are very likely small transcription errors (a few tokens). A compiler will likely catch most of these errors. Hence, the majority of residual faults in a program is likely to be due to small (single token) variations at certain points in the structure of the program from the correct program (This particular assumption is called the <em>Competent Programmer Hypothesis</em> or the <em>Finite Neighborhood Hypothesis</em>).</p>
<p>What about the larger faults composed of multiple smaller faults? The key insight here is that, for a majority of such complex faults, test cases that detect a single smaller fault in isolation is very likely to detect the larger complex fault that contains it. (This assumption is called the <em>Coupling Effect</em>.)</p>
<p>How can we use these assumptions in practice? The idea is to simply generate <em>all</em> possible <em>valid</em> variants of the program that differs from the original by a small change (such as a single token change) (Such variants are called <em>mutants</em>). Next, the given test suite is applied to each variant thus generated. Any mutant detected by the test suite is said to have been <em>killed</em> by the test suite. The effectiveness of a test suite is given by the proportion of mutants killed to the valid mutants generated.</p>
<p>We next implement a simple mutation analysis framework and use it to evaluate our test suites.</p>
</section>
<section id="mutating-python-code">
<h2>Mutating Python Code<a class="headerlink" href="#mutating-python-code" title="Link to this heading">#</a></h2>
<p>To manipulate a Python program, we work on the <em>abstract syntax tree</em> (AST) representation – which is the internal representation compilers and interpreters work on after reading in the program text.</p>
<p>Briefly speaking, we convert the program into a tree, and then <em>change parts of this tree</em> – for instance, by changing <code class="docutils literal notranslate"><span class="pre">+</span></code> operators into <code class="docutils literal notranslate"><span class="pre">-</span></code> or vice versa, or actual statements into <code class="docutils literal notranslate"><span class="pre">pass</span></code> statements that do nothing.  The resulting mutated tree can then be processed further; it can be passed on to the Python interpreter for execution, or we can <em>unparse</em> it back into a textual form.</p>
<p>We begin by importing the AST manipulation modules.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">inspect</span>
</pre></div>
</div>
</div>
</div>
<p>We can get the source of a Python function using <code class="docutils literal notranslate"><span class="pre">inspect.getsource()</span></code>.  (Note that this does not work for functions defined in other notebooks.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">triangle_source</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
<span class="n">triangle_source</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;def triangle(a, b, c):\n    if a == b:\n        if b == c:\n            return \&#39;Equilateral\&#39;\n        else:\n            return \&#39;Isosceles\&#39;\n    else:\n        if b == c:\n            return &quot;Isosceles&quot;\n        else:\n            if a == c:\n                return &quot;Isosceles&quot;\n            else:\n                return &quot;Scalene&quot;\n&#39;
</pre></div>
</div>
</div>
</div>
<p>To view these in a visually pleasing form, our function <code class="docutils literal notranslate"><span class="pre">print_content(s,</span> <span class="pre">suffix)</span></code> formats and highlights the string <code class="docutils literal notranslate"><span class="pre">s</span></code> as if it were a file with ending <code class="docutils literal notranslate"><span class="pre">suffix</span></code>.  We can thus view (and highlight) the source as if it were a Python file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bookutils</span> <span class="kn">import</span> <span class="n">print_content</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">triangle_source</span><span class="p">,</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span> <span class=" -Color -Color-Green">triangle</span>(a, b, c):
    <span class=" -Color -Color-Blue">if</span> a == b:
        <span class=" -Color -Color-Blue">if</span> b == c:
            <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Equilateral&#39;</span>
        <span class=" -Color -Color-Blue">else</span>:
            <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Isosceles&#39;</span>
    <span class=" -Color -Color-Blue">else</span>:
        <span class=" -Color -Color-Blue">if</span> b == c:
            <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&quot;Isosceles&quot;</span>
        <span class=" -Color -Color-Blue">else</span>:
            <span class=" -Color -Color-Blue">if</span> a == c:
                <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&quot;Isosceles&quot;</span>
            <span class=" -Color -Color-Blue">else</span>:
                <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&quot;Scalene&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Parsing this gives us an abstract syntax tree (AST) – a representation of the program in tree form.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">triangle_ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">triangle_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What does this AST look like?  The helper functions <code class="docutils literal notranslate"><span class="pre">ast.dump()</span></code> (textual output) and <code class="docutils literal notranslate"><span class="pre">showast.show_ast()</span></code> (graphical output with <a class="reference external" href="https://github.com/hchasestevens/show_ast">showast</a>) allow us to inspect the structure of the tree.  We see that the function starts as a <code class="docutils literal notranslate"><span class="pre">FunctionDef</span></code> with name and arguments, followed by a body, which is a list of statements; in this case, the body contains only an <code class="docutils literal notranslate"><span class="pre">If</span></code>, which itself contains other nodes of type <code class="docutils literal notranslate"><span class="pre">If</span></code>, <code class="docutils literal notranslate"><span class="pre">Compare</span></code>, <code class="docutils literal notranslate"><span class="pre">Name</span></code>, <code class="docutils literal notranslate"><span class="pre">Str</span></code>, and <code class="docutils literal notranslate"><span class="pre">Return</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">triangle_ast</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Module(
    body=[
        FunctionDef(
            name=&#39;triangle&#39;,
            args=arguments(
                posonlyargs=[],
                args=[
                    arg(arg=&#39;a&#39;),
                    arg(arg=&#39;b&#39;),
                    arg(arg=&#39;c&#39;)],
                kwonlyargs=[],
                kw_defaults=[],
                defaults=[]),
            body=[
                If(
                    test=Compare(
                        left=Name(id=&#39;a&#39;, ctx=Load()),
                        ops=[
                            Eq()],
                        comparators=[
                            Name(id=&#39;b&#39;, ctx=Load())]),
                    body=[
                        If(
                            test=Compare(
                                left=Name(id=&#39;b&#39;, ctx=Load()),
                                ops=[
                                    Eq()],
                                comparators=[
                                    Name(id=&#39;c&#39;, ctx=Load())]),
                            body=[
                                Return(
                                    value=Constant(value=&#39;Equilateral&#39;))],
                            orelse=[
                                Return(
                                    value=Constant(value=&#39;Isosceles&#39;))])],
                    orelse=[
                        If(
                            test=Compare(
                                left=Name(id=&#39;b&#39;, ctx=Load()),
                                ops=[
                                    Eq()],
                                comparators=[
                                    Name(id=&#39;c&#39;, ctx=Load())]),
                            body=[
                                Return(
                                    value=Constant(value=&#39;Isosceles&#39;))],
                            orelse=[
                                If(
                                    test=Compare(
                                        left=Name(id=&#39;a&#39;, ctx=Load()),
                                        ops=[
                                            Eq()],
                                        comparators=[
                                            Name(id=&#39;c&#39;, ctx=Load())]),
                                    body=[
                                        Return(
                                            value=Constant(value=&#39;Isosceles&#39;))],
                                    orelse=[
                                        Return(
                                            value=Constant(value=&#39;Scalene&#39;))])])])],
            decorator_list=[],
            type_params=[])],
    type_ignores=[])
</pre></div>
</div>
</div>
</div>
<p>Too much text for you?  This graphical representation may make things simpler.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bookutils</span> <span class="kn">import</span> <span class="n">rich_output</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">rich_output</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">showast</span>
    <span class="n">showast</span><span class="o">.</span><span class="n">show_ast</span><span class="p">(</span><span class="n">triangle_ast</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d8bf4e1973e7f40930bb422b2738e02d9fe6fe5ec919da5aeeb11b3005bb9e09.svg" src="_images/d8bf4e1973e7f40930bb422b2738e02d9fe6fe5ec919da5aeeb11b3005bb9e09.svg" />
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">ast.unparse()</span></code> converts such a tree back into the more familiar textual Python code representation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_content</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">triangle_ast</span><span class="p">),</span> <span class="s1">&#39;.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Blue">def</span> <span class=" -Color -Color-Green">triangle</span>(a, b, c):
    <span class=" -Color -Color-Blue">if</span> a == b:
        <span class=" -Color -Color-Blue">if</span> b == c:
            <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Equilateral&#39;</span>
        <span class=" -Color -Color-Blue">else</span>:
            <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Isosceles&#39;</span>
    <span class=" -Color -Color-Blue">elif</span> b == c:
        <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Isosceles&#39;</span>
    <span class=" -Color -Color-Blue">elif</span> a == c:
        <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Isosceles&#39;</span>
    <span class=" -Color -Color-Blue">else</span>:
        <span class=" -Color -Color-Blue">return</span> <span class=" -Color -Color-Yellow">&#39;Scalene&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-simple-mutator-for-functions">
<h2>A Simple Mutator for Functions<a class="headerlink" href="#a-simple-mutator-for-functions" title="Link to this heading">#</a></h2>
<p>Let us now go and mutate the <code class="docutils literal notranslate"><span class="pre">triangle()</span></code> program. A simple way to produce valid mutated version of this program is to replace some of its statements by <code class="docutils literal notranslate"><span class="pre">pass</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> is the main class responsible for mutation analysis of the test suite. It accepts the function to be tested. It normalizes the source code given by parsing and unparsing it once, using the functions discussed above. This is required to ensure that later <code class="docutils literal notranslate"><span class="pre">diff</span></code>s between the original and mutant are not derailed by differences in whitespace, comments, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuFunctionAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ast</span><span class="p">)</span>  <span class="c1"># normalize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutator_object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmutations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">un_detected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutants</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>

    <span class="k">def</span> <span class="nf">mutator_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">StmtDeletionMutator</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_mutation_count()</span></code> fetches the number of possible mutations available. We will see later how this can be implemented.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_mutation_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutator</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ast</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutator</span><span class="o">.</span><span class="n">count</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Mutator</span></code> provides the base class for implementing individual mutations. It accepts a list of locations to mutate. It assumes that the method <code class="docutils literal notranslate"><span class="pre">mutable_visit()</span></code> is invoked on all nodes of interest as determined by the subclass. When the <code class="docutils literal notranslate"><span class="pre">Mutator</span></code> is invoked without a list of locations to mutate, it simply loops through all possible mutation points and retains a count in <code class="docutils literal notranslate"><span class="pre">self.count</span></code>. If it is invoked with a specific list of locations to mutate, the <code class="docutils literal notranslate"><span class="pre">mutable_visit()</span></code> method calls the <code class="docutils literal notranslate"><span class="pre">mutation_visit()</span></code> which performs the mutation on the node. Note that a single location can produce multiple mutations. (Hence the hashmap).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutator</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutate_location</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutate_location</span> <span class="o">=</span> <span class="n">mutate_location</span>

    <span class="k">def</span> <span class="nf">mutable_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># statements start at line no 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate_location</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">StmtDeletionMutator</span></code> simply hooks into all the statement processing visitors. It performs mutation by replacing the given statement with <code class="docutils literal notranslate"><span class="pre">pass</span></code>.  As you can see, it visits all kinds of statements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StmtDeletionMutator</span><span class="p">(</span><span class="n">Mutator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">visit_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_Delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_AnnAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_AugAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Raise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_Assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_Nonlocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Pass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_Break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">visit_Continue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The actual mutation consists of replacing the node with a <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StmtDeletionMutator</span><span class="p">(</span><span class="n">StmtDeletionMutator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mutation_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">()</span>    
</pre></div>
</div>
</div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">triangle()</span></code>, this visitor produces five mutations – namely, replacing the five <code class="docutils literal notranslate"><span class="pre">return</span></code> statements with <code class="docutils literal notranslate"><span class="pre">pass</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span><span class="o">.</span><span class="n">nmutations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<p>We need a way to obtain the individual mutants. For this, we convert our <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> to an <em>iterable</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PMIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">PMIterator</span></code>, which is the <em>iterator</em> class for <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> is defined as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PMIterator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">next()</span></code> method returns the corresponding <code class="docutils literal notranslate"><span class="pre">Mutant</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PMIterator</span><span class="p">(</span><span class="n">PMIterator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">nmutations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">mutant</span> <span class="o">=</span> <span class="n">Mutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">mutant</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mutant</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Mutant</span></code> class contains logic for generating mutants when given the locations to mutate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutant</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pm</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how it can be used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">triangle</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>triangle_1
triangle_2
triangle_3
triangle_4
triangle_5
</pre></div>
</div>
</div>
</div>
<p>These names are a bit generic yet.  Let’s see whether we can get more insights into the mutations produced.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_mutant()</span></code> simply calls the <code class="docutils literal notranslate"><span class="pre">mutator()</span></code> method, and passes the mutator a copy of the AST.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Mutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">generate_mutant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
        <span class="n">mutant_ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">mutator_object</span><span class="p">(</span>
            <span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">src</span><span class="p">))</span>  <span class="c1"># copy</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">mutant_ast</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">src()</span></code> method returns the mutated source.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Mutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_mutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how one can obtain the mutants, and visualize the difference from the original:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">difflib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">triangle</span><span class="p">):</span>
    <span class="n">shape_src</span> <span class="o">=</span> <span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">src</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span>
                                     <span class="n">mutant</span><span class="o">.</span><span class="n">src</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span>
                                     <span class="n">fromfile</span><span class="o">=</span><span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                     <span class="n">tofile</span><span class="o">=</span><span class="n">mutant</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- triangle

+++ triangle_1

@@ -1,7 +1,7 @@

 def triangle(a, b, c):
     if a == b:
         if b == c:
-            return &#39;Equilateral&#39;
+            pass
         else:
             return &#39;Isosceles&#39;
     elif b == c:
--- triangle

+++ triangle_2

@@ -3,7 +3,7 @@

         if b == c:
             return &#39;Equilateral&#39;
         else:
-            return &#39;Isosceles&#39;
+            pass
     elif b == c:
         return &#39;Isosceles&#39;
     elif a == c:
--- triangle

+++ triangle_3

@@ -5,7 +5,7 @@

         else:
             return &#39;Isosceles&#39;
     elif b == c:
-        return &#39;Isosceles&#39;
+        pass
     elif a == c:
         return &#39;Isosceles&#39;
     else:
--- triangle

+++ triangle_4

@@ -7,6 +7,6 @@

     elif b == c:
         return &#39;Isosceles&#39;
     elif a == c:
-        return &#39;Isosceles&#39;
+        pass
     else:
         return &#39;Scalene&#39;
--- triangle

+++ triangle_5

@@ -9,4 +9,4 @@

     elif a == c:
         return &#39;Isosceles&#39;
     else:
-        return &#39;Scalene&#39;
+        pass
</pre></div>
</div>
</div>
</div>
<p>In this <code class="docutils literal notranslate"><span class="pre">diff</span></code> output, lines prefixed with <code class="docutils literal notranslate"><span class="pre">+</span></code> are added, whereas lines prefixed with <code class="docutils literal notranslate"><span class="pre">-</span></code> are deleted.  We see that each of the five mutants indeed replaces a return statement with a <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement.</p>
<p>We add the <code class="docutils literal notranslate"><span class="pre">diff()</span></code> method to <code class="docutils literal notranslate"><span class="pre">Mutant</span></code> so that it can be called directly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Mutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span>
                                              <span class="n">fromfile</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span>
                                              <span class="n">tofile</span><span class="o">=</span><span class="s1">&#39;mutant&#39;</span><span class="p">,</span>
                                              <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluating-mutations">
<h2>Evaluating Mutations<a class="headerlink" href="#evaluating-mutations" title="Link to this heading">#</a></h2>
<p>We are now ready to implement the actual evaluation. We define our mutant as a <em>context manager</em> that verifies whether all assertions given succeed.  The idea is that we can write code such as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span>
</pre></div>
</div>
<p>and while <code class="docutils literal notranslate"><span class="pre">mutant</span></code> is active (i.e., the code block under <code class="docutils literal notranslate"><span class="pre">with:</span></code>), the original function is replaced by the mutated function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__enter__()</span></code> function is called when the <code class="docutils literal notranslate"><span class="pre">with</span></code> block is entered.  It creates the mutant as a Python function and places it in the global namespace, such that the <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement executes the mutated function rather than the original.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Mutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&gt;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">(),</span> <span class="s1">&#39;&lt;mutant&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
        <span class="nb">eval</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">__exit__()</span></code> function checks whether an exception has occurred (i.e., the assertion failed, or some other error was raised); if so, it marks the mutation as <code class="docutils literal notranslate"><span class="pre">detected</span></code>.  Finally, it restores the original function definition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Mutant</span><span class="p">(</span><span class="n">Mutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;-</span><span class="se">\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detected </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)</span>
        <span class="nb">globals</span><span class="p">()[</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">fn</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">finish()</span></code> method simply invokes the method on the mutant, checks if the mutant was discovered, and returns the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ExpectError</span> <span class="kn">import</span> <span class="n">ExpectTimeout</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">un_detected</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">mutant</span> <span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutants</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">mutant</span><span class="o">.</span><span class="n">detected</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>The mutation score – the ratio of mutants detected by the test suite - is computed by <code class="docutils literal notranslate"><span class="pre">score()</span></code>.  A score of 1.0 means that all mutants were discovered; a score of 0.1 means that only 10% of mutants were detected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmutations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">un_detected</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmutations</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how we use our framework.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Equilateral&#39;</span><span class="p">,</span> <span class="s2">&quot;Equal Check1&quot;</span>
        <span class="k">assert</span> <span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span><span class="p">,</span> <span class="s2">&quot;Equal Check2&quot;</span>
        <span class="k">assert</span> <span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span><span class="p">,</span> <span class="s2">&quot;Equal Check3&quot;</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-&gt;	triangle_1
&lt;-	triangle_1
Detected triangle_1 &lt;class &#39;AssertionError&#39;&gt; Equal Check1

-&gt;	triangle_2
&lt;-	triangle_2

-&gt;	triangle_3
&lt;-	triangle_3

-&gt;	triangle_4
&lt;-	triangle_4

-&gt;	triangle_5
&lt;-	triangle_5
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2
</pre></div>
</div>
</div>
</div>
<p>Only one out of five mutations resulted in a failing assertion.  Hence, the <code class="docutils literal notranslate"><span class="pre">weak_oracle()</span></code> test suite gets a mutation score of 20%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">triangle</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
        <span class="n">weak_oracle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2
</pre></div>
</div>
</div>
</div>
<p>Since we are modifying the global namespace, we do not have to refer to the function directly within the for loop of mutant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">oracle</span><span class="p">():</span>
    <span class="n">strong_oracle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
        <span class="n">oracle</span><span class="p">()</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-&gt;	triangle_1
&lt;-	triangle_1
Detected triangle_1 &lt;class &#39;AssertionError&#39;&gt; 

-&gt;	triangle_2
&lt;-	triangle_2
Detected triangle_2 &lt;class &#39;AssertionError&#39;&gt; 

-&gt;	triangle_3
&lt;-	triangle_3
Detected triangle_3 &lt;class &#39;AssertionError&#39;&gt; 

-&gt;	triangle_4
&lt;-	triangle_4
Detected triangle_4 &lt;class &#39;AssertionError&#39;&gt; 

-&gt;	triangle_5
&lt;-	triangle_5
Detected triangle_5 &lt;class &#39;AssertionError&#39;&gt; 
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>That is, we were able to achieve <code class="docutils literal notranslate"><span class="pre">100%</span></code> mutation score with the <code class="docutils literal notranslate"><span class="pre">strong_oracle()</span></code> test suite.</p>
<p>Here is another example. <code class="docutils literal notranslate"><span class="pre">gcd()</span></code> computes the greatest common divisor of two numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">%</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s a test for it.  How effective is it?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">gcd</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Minimal&quot;</span>
        <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mirror&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-&gt;	gcd_1
&lt;-	gcd_1
Detected gcd_1 &lt;class &#39;UnboundLocalError&#39;&gt; cannot access local variable &#39;c&#39; where it is not associated with a value

-&gt;	gcd_2
&lt;-	gcd_2
Detected gcd_2 &lt;class &#39;AssertionError&#39;&gt; Mirror

-&gt;	gcd_3
&lt;-	gcd_3

-&gt;	gcd_4
&lt;-	gcd_4

-&gt;	gcd_5
&lt;-	gcd_5

-&gt;	gcd_6
&lt;-	gcd_6

-&gt;	gcd_7
&lt;-	gcd_7
Detected gcd_7 &lt;class &#39;AssertionError&#39;&gt; Minimal
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.42857142857142855
</pre></div>
</div>
</div>
</div>
<p>We see that our <code class="docutils literal notranslate"><span class="pre">TestGCD</span></code> test suite is able to obtain a mutation score of 42%.</p>
</section>
<section id="mutator-for-modules-and-test-suites">
<h2>Mutator for Modules and Test Suites<a class="headerlink" href="#mutator-for-modules-and-test-suites" title="Link to this heading">#</a></h2>
<p>Consider the <code class="docutils literal notranslate"><span class="pre">triangle()</span></code> program we discussed previously. As we discussed, a simple way to produce valid mutated version of this program is to replace some of its statements by <code class="docutils literal notranslate"><span class="pre">pass</span></code>.</p>
<p>For demonstration purposes, we would like to proceed as though the program was in a different file. We can do that by producing a <code class="docutils literal notranslate"><span class="pre">Module</span></code> object in Python, and attaching the function to it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">types</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">import_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span>
</pre></div>
</div>
</div>
</div>
<p>We attach the <code class="docutils literal notranslate"><span class="pre">triangle()</span></code> function to the <code class="docutils literal notranslate"><span class="pre">shape</span></code> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span> <span class="o">=</span> <span class="n">import_code</span><span class="p">(</span><span class="n">shape_src</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now invoke triangle through the module <code class="docutils literal notranslate"><span class="pre">shape</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Equilateral&#39;
</pre></div>
</div>
</div>
</div>
<p>We want to test the <code class="docutils literal notranslate"><span class="pre">triangle()</span></code> function. For that, we define a <code class="docutils literal notranslate"><span class="pre">StrongShapeTest</span></code> class as below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StrongShapeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_equilateral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Equilateral&#39;</span>

    <span class="k">def</span> <span class="nf">test_isosceles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Isosceles&#39;</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Isosceles&#39;</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Isosceles&#39;</span>

    <span class="k">def</span> <span class="nf">test_scalene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Scalene&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We define a helper function <code class="docutils literal notranslate"><span class="pre">suite()</span></code> that looks through a given class and identifies the test functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">suite</span><span class="p">(</span><span class="n">test_class</span><span class="p">):</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">test_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;test_&#39;</span><span class="p">):</span>
            <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">test_class</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">suite</span>
</pre></div>
</div>
</div>
</div>
<p>The tests in <code class="docutils literal notranslate"><span class="pre">TestTriangle</span></code> class can be invoked with different test runners. The simplest is to directly invoke the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">TestCase</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">suite</span><span class="p">(</span><span class="n">StrongShapeTest</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestResult</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;unittest.result.TestResult run=3 errors=0 failures=0&gt;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TextTestRunner</span></code> class provides ability to control the verbosity of execution. It also allows one to return on the <em>first</em> failure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">failfast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">(</span><span class="n">StrongShapeTest</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>----------------------------------------------------------------------
Ran 3 tests in 0.000s

OK
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;unittest.runner.TextTestResult run=3 errors=0 failures=0&gt;
</pre></div>
</div>
</div>
</div>
<p>Running the program under coverage is accomplished as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">VisualCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">suite</span><span class="p">(</span><span class="n">StrongShapeTest</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestResult</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>The coverage obtained is given by:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span><span class="o">.</span><span class="n">show_coverage</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   1: def triangle(a, b, c):
#  2:     if a == b:
#  3:         if b == c:
#  4:             return &#39;Equilateral&#39;
   5:         else:
#  6:             return &#39;Isosceles&#39;
#  7:     else:
#  8:         if b == c:
#  9:             return &quot;Isosceles&quot;
# 10:         else:
  11:             if a == c:
# 12:                 return &quot;Isosceles&quot;
  13:             else:
  14:                 return &quot;Scalene&quot;
  15: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WeakShapeTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_equilateral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Equilateral&#39;</span>

    <span class="k">def</span> <span class="nf">test_isosceles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>

    <span class="k">def</span> <span class="nf">test_scalene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">shape</span><span class="o">.</span><span class="n">triangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Equilateral&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>How much coverage does it obtain?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">VisualCoverage</span><span class="p">()</span> <span class="k">as</span> <span class="n">cov</span><span class="p">:</span>
    <span class="n">suite</span><span class="p">(</span><span class="n">WeakShapeTest</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestResult</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cov</span><span class="o">.</span><span class="n">show_coverage</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   1: def triangle(a, b, c):
#  2:     if a == b:
#  3:         if b == c:
#  4:             return &#39;Equilateral&#39;
   5:         else:
#  6:             return &#39;Isosceles&#39;
#  7:     else:
#  8:         if b == c:
#  9:             return &quot;Isosceles&quot;
# 10:         else:
  11:             if a == c:
# 12:                 return &quot;Isosceles&quot;
  13:             else:
  14:                 return &quot;Scalene&quot;
  15: 
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MuProgramAnalyzer</span></code> is the main class responsible for mutation analysis of the test suite. It accepts the name of the module to be tested, and its source code. It normalizes the source code given by parsing and unparsing it once. This is required to ensure that later <code class="docutils literal notranslate"><span class="pre">diff</span></code>s between the original and mutant are not derailed by differences in whitespace, comments, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuProgramAnalyzer</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ast</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">src</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ast</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutator_object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nmutations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mutation_count</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">un_detected</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mutator_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AdvStmtDeletionMutator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We now extend the <code class="docutils literal notranslate"><span class="pre">Mutator</span></code> class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvMutator</span><span class="p">(</span><span class="n">Mutator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">mutate_locations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutate_locations</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">mutate_locations</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mutate_locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="n">analyzer</span>

    <span class="k">def</span> <span class="nf">mutable_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># statements start at line no 1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">AdvStmtDeletionMutator</span></code> simply hooks into all the statement processing visitors. It performs mutation by replacing the given statement with <code class="docutils literal notranslate"><span class="pre">pass</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvStmtDeletionMutator</span><span class="p">(</span><span class="n">AdvMutator</span><span class="p">,</span> <span class="n">StmtDeletionMutator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">mutate_locations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">AdvMutator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analyzer</span><span class="p">,</span> <span class="n">mutate_locations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mutation_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># there is only one way to delete a statement -- replace it by pass</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate_locations</span><span class="p">:</span>  <span class="c1"># counting pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get matching changes for this pass</span>
            <span class="n">mutating_lines</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">count</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate_locations</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mutating_lines</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Pass</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Aagin, we can obtain the number of mutations produced for <code class="docutils literal notranslate"><span class="pre">triangle()</span></code> as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="n">shape_src</span><span class="p">)</span><span class="o">.</span><span class="n">nmutations</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<p>We need a way to obtain the individual mutants. For this, we convert our <code class="docutils literal notranslate"><span class="pre">MuProgramAnalyzer</span></code> to an <em>iterable</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuProgramAnalyzer</span><span class="p">(</span><span class="n">MuProgramAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AdvPMIterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">AdvPMIterator</span></code>, which is the <em>iterator</em> class for <code class="docutils literal notranslate"><span class="pre">MuProgramAnalyzer</span></code> is defined as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvPMIterator</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">next()</span></code> method returns the corresponding <code class="docutils literal notranslate"><span class="pre">Mutant</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvPMIterator</span><span class="p">(</span><span class="n">AdvPMIterator</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">changes</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># there could be multiple changes in one mutant</span>
        <span class="k">return</span> <span class="n">AdvMutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">changes</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Mutant</span></code> class contains logic for generating mutants when given the locations to mutate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvMutant</span><span class="p">(</span><span class="n">Mutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pm</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                               <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how it can be used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shape_src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="n">shape_src</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape_(1, 0)
shape_(2, 0)
shape_(3, 0)
shape_(4, 0)
shape_(5, 0)
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">generate_mutant()</span></code> simply calls the <code class="docutils literal notranslate"><span class="pre">mutator()</span></code> method, and passes the mutator a copy of the AST.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvMutant</span><span class="p">(</span><span class="n">AdvMutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">generate_mutant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
        <span class="n">mutant_ast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">mutator_object</span><span class="p">(</span>
            <span class="n">locations</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">src</span><span class="p">))</span>  <span class="c1"># copy</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">mutant_ast</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">src()</span></code> method returns the mutated source.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvMutant</span><span class="p">(</span><span class="n">AdvMutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_mutant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span>
</pre></div>
</div>
</div>
</div>
<p>Again, we visualize mutants as difference from the original:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">difflib</span>
</pre></div>
</div>
</div>
</div>
<p>We add the <code class="docutils literal notranslate"><span class="pre">diff()</span></code> method to <code class="docutils literal notranslate"><span class="pre">Mutant</span></code> so that it can be called directly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvMutant</span><span class="p">(</span><span class="n">AdvMutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">),</span>
                                              <span class="n">fromfile</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span>
                                              <span class="n">tofile</span><span class="o">=</span><span class="s1">&#39;mutant&#39;</span><span class="p">,</span>
                                              <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="n">shape_src</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mutant</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mutant</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>shape_(1, 0)
--- original

+++ mutant

@@ -1,7 +1,7 @@

 def triangle(a, b, c):
     if a == b:
         if b == c:
-            return &#39;Equilateral&#39;
+            pass
         else:
             return &#39;Isosceles&#39;
     elif b == c:
</pre></div>
</div>
</div>
</div>
<p>We are now ready to implement the actual evaluation. For doing that, we require the ability to accept the module where the test suite is defined, and invoke the test method on it. The method <code class="docutils literal notranslate"><span class="pre">getitem</span></code> accepts the test module, fixes the import entries on the test module to correctly point to the mutant module, and passes it to the test runner <code class="docutils literal notranslate"><span class="pre">MutantTestRunner</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AdvMutant</span><span class="p">(</span><span class="n">AdvMutant</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_module</span><span class="p">):</span>
        <span class="n">test_module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">import_code</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MutantTestRunner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_module</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MutantTestRunner</span></code> simply calls all <code class="docutils literal notranslate"><span class="pre">test_</span></code> methods on the test module, checks if the mutant was discovered, and returns the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ExpectError</span> <span class="kn">import</span> <span class="n">ExpectTimeout</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MutantTestRunner</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutant</span><span class="p">,</span> <span class="n">test_module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutant</span> <span class="o">=</span> <span class="n">mutant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tm</span> <span class="o">=</span> <span class="n">test_module</span>

    <span class="k">def</span> <span class="nf">runTest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tc</span><span class="p">):</span>
        <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
        <span class="n">test_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tm</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">tc</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">test_class</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;test_&#39;</span><span class="p">):</span>
                <span class="n">suite</span><span class="o">.</span><span class="n">addTest</span><span class="p">(</span><span class="n">test_class</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">failfast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ExpectTimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">wasSuccessful</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">un_detected</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">res</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Syntax Error (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutant</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unhandled exception during test execution&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The mutation score is computed by <code class="docutils literal notranslate"><span class="pre">score()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuProgramAnalyzer</span><span class="p">(</span><span class="n">MuProgramAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmutations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">un_detected</span><span class="p">))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmutations</span>
</pre></div>
</div>
</div>
</div>
<p>Here is how we use our framework.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>
<span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="n">shape_src</span><span class="p">):</span>
    <span class="n">mutant</span><span class="p">[</span><span class="n">test_module</span><span class="p">]</span><span class="o">.</span><span class="n">runTest</span><span class="p">(</span><span class="s1">&#39;WeakShapeTest&#39;</span><span class="p">)</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
FAIL: test_equilateral (__main__.WeakShapeTest.test_equilateral)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/511514204.py&quot;, line 3, in test_equilateral
    assert shape.triangle(1, 1, 1) == &#39;Equilateral&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
----------------------------------------------------------------------
Ran 3 tests in 0.000s

OK
----------------------------------------------------------------------
Ran 3 tests in 0.000s

OK
----------------------------------------------------------------------
Ran 3 tests in 0.000s

OK
----------------------------------------------------------------------
Ran 3 tests in 0.000s

OK
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">WeakShape</span></code> test suite resulted in only <code class="docutils literal notranslate"><span class="pre">20%</span></code> mutation score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="n">shape_src</span><span class="p">):</span>
    <span class="n">mutant</span><span class="p">[</span><span class="n">test_module</span><span class="p">]</span><span class="o">.</span><span class="n">runTest</span><span class="p">(</span><span class="s1">&#39;StrongShapeTest&#39;</span><span class="p">)</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
FAIL: test_equilateral (__main__.StrongShapeTest.test_equilateral)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2670057129.py&quot;, line 4, in test_equilateral
    assert shape.triangle(1, 1, 1) == &#39;Equilateral&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_isosceles (__main__.StrongShapeTest.test_isosceles)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2670057129.py&quot;, line 8, in test_isosceles
    assert shape.triangle(2, 2, 1) == &#39;Isosceles&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 2 tests in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_isosceles (__main__.StrongShapeTest.test_isosceles)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2670057129.py&quot;, line 9, in test_isosceles
    assert shape.triangle(1, 2, 2) == &#39;Isosceles&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 2 tests in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_isosceles (__main__.StrongShapeTest.test_isosceles)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2670057129.py&quot;, line 7, in test_isosceles
    assert shape.triangle(1, 2, 1) == &#39;Isosceles&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 2 tests in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_scalene (__main__.StrongShapeTest.test_scalene)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2670057129.py&quot;, line 12, in test_scalene
    assert shape.triangle(1, 2, 3) == &#39;Scalene&#39;
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 3 tests in 0.000s

FAILED (failures=1)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>On the other hand, we were able to achieve <code class="docutils literal notranslate"><span class="pre">100%</span></code> mutation score with <code class="docutils literal notranslate"><span class="pre">StrongShapeTest</span></code> test suite.</p>
<p>Here is another example, <code class="docutils literal notranslate"><span class="pre">gcd()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gcd_src</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">gcd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestGCD</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">test_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;cfg&#39;</span><span class="p">,</span> <span class="n">gcd_src</span><span class="p">):</span>
    <span class="n">mutant</span><span class="p">[</span><span class="n">test_module</span><span class="p">]</span><span class="o">.</span><span class="n">runTest</span><span class="p">(</span><span class="s1">&#39;TestGCD&#39;</span><span class="p">)</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
ERROR: test_mirror (__main__.TestGCD.test_mirror)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 6, in test_mirror
    assert cfg.gcd(0, 1) == 1
           ^^^^^^^^^^^^^
  File &quot;&lt;string&gt;&quot;, line 5, in gcd
UnboundLocalError: cannot access local variable &#39;c&#39; where it is not associated with a value

----------------------------------------------------------------------
Ran 2 tests in 0.000s

FAILED (errors=1)
======================================================================
FAIL: test_mirror (__main__.TestGCD.test_mirror)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 6, in test_mirror
    assert cfg.gcd(0, 1) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 2 tests in 0.000s

FAILED (failures=1)
----------------------------------------------------------------------
Ran 2 tests in 0.000s

OK
----------------------------------------------------------------------
Ran 2 tests in 0.000s

OK
----------------------------------------------------------------------
Ran 2 tests in 0.000s

OK
----------------------------------------------------------------------
Ran 2 tests in 0.000s

OK
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.42857142857142855
</pre></div>
</div>
</div>
</div>
<p>We see that our <code class="docutils literal notranslate"><span class="pre">TestGCD</span></code> test suite is able to obtain <code class="docutils literal notranslate"><span class="pre">42%</span></code> mutation score.</p>
</section>
<section id="the-problem-of-equivalent-mutants">
<h2>The Problem of  Equivalent Mutants<a class="headerlink" href="#the-problem-of-equivalent-mutants" title="Link to this heading">#</a></h2>
<p>One of the problems with mutation analysis is that not all mutants generated need to be faulty. For example, consider the <code class="docutils literal notranslate"><span class="pre">new_gcd()</span></code> program below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<p>This program can be mutated to produce the following mutant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mutated_gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">while</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">new_gcd</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mutant</span><span class="o">.</span><span class="n">src</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 def new_gcd(a, b):
    if a &lt; b:
        pass
    else:
        a, b = (a, b)
    while b != 0:
        a, b = (b, a % b)
    return a
1 def new_gcd(a, b):
    if a &lt; b:
        a, b = (b, a)
    else:
        pass
    while b != 0:
        a, b = (b, a % b)
    return a
2 def new_gcd(a, b):
    if a &lt; b:
        a, b = (b, a)
    else:
        a, b = (a, b)
    while b != 0:
        pass
    return a
3 def new_gcd(a, b):
    if a &lt; b:
        a, b = (b, a)
    else:
        a, b = (a, b)
    while b != 0:
        a, b = (b, a % b)
    pass
</pre></div>
</div>
</div>
</div>
<p>While other mutants are faulty compared to the original, <code class="docutils literal notranslate"><span class="pre">mutant</span> <span class="pre">1</span></code> is indistinguishable from the original in terms of its semantics because it removes an inconsequential assignment. This means that <code class="docutils literal notranslate"><span class="pre">mutant</span> <span class="pre">1</span></code> does not represent a fault. These kinds of mutants that do not represent a fault are called <em>Equivalent mutants</em>. The problem with equivalent mutants is that it becomes very difficult to judge the mutation score in the presence of equivalent mutants. For example, with a mutation score of 70%, anywhere from 0 to 30% of the mutants may be equivalent. Hence, without knowing the actual number of equivalent mutants, it is impossible to judge how much the tests can be improved. We discuss two methods to deal with equivalent mutants.</p>
<section id="statistical-estimation-of-number-of-equivalent-mutants">
<h3>Statistical Estimation of Number of Equivalent Mutants<a class="headerlink" href="#statistical-estimation-of-number-of-equivalent-mutants" title="Link to this heading">#</a></h3>
<p>If the number of mutants that are alive is small enough, one may rely on simply inspecting them manually. However, if the number of mutants are sufficiently large (say &gt; 1000), one may choose a smaller number of mutants from the alive mutants randomly and manually evaluate them to see whether they represent faults. The sample size determination is governed by the following formula for a binomial distribution (approximated by a normal distribution):</p>
<div class="math notranslate nohighlight">
\[
n \ge \hat{p}(1-\hat{p})\bigg(\frac{Z_{\frac{\alpha}{2}}}{\Delta}\bigg)^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the number of samples, <span class="math notranslate nohighlight">\(p\)</span> is the parameter for the probability distribution, <span class="math notranslate nohighlight">\(\alpha\)</span> is the accuracy desired, <span class="math notranslate nohighlight">\(\Delta\)</span> the precision. For an accuracy of <span class="math notranslate nohighlight">\(95\%\)</span>, <span class="math notranslate nohighlight">\(Z_{0.95}=1.96\)</span>. we have the following values (the maximum value of <span class="math notranslate nohighlight">\(\hat{p}(1-\hat{p}) = 0.25\)</span>) and <span class="math notranslate nohighlight">\(Z\)</span> is the critical value for normal distribution:</p>
<div class="math notranslate nohighlight">
\[
n \ge 0.25\bigg(\frac{1.96}{\Delta}\bigg)^2
\]</div>
<p>For <span class="math notranslate nohighlight">\(\Delta = 0.01\)</span>, (that is for a maximum error of 1%), we need to evaluate <span class="math notranslate nohighlight">\(9604\)</span> mutants for equivalence. If one relaxes the constraint to <span class="math notranslate nohighlight">\(\Delta = 0.1\)</span> (that is an error of <span class="math notranslate nohighlight">\(10\%\)</span>), then one needs to evaluate only <span class="math notranslate nohighlight">\(96\)</span> mutants for equivalence.</p>
</section>
<section id="statistical-estimation-of-the-number-of-immortals-by-chaos-estimator">
<h3>Statistical Estimation of the Number of Immortals by Chao’s Estimator<a class="headerlink" href="#statistical-estimation-of-the-number-of-immortals-by-chaos-estimator" title="Link to this heading">#</a></h3>
<p>While the idea of sampling only a limited number of mutants is appealing, it is still limited in that manual analysis is necessary. If computing power is cheap, another way to estimate the number of true mutants (and hence the number of equivalent mutants) is by means of Chao’s estimator. As we will see in the chapter on <a class="reference internal" href="WhenToStopFuzzing.html"><span class="std std-doc">when to stop fuzzing</span></a>, the formula is given by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\hat S_\text{Chao1} = \begin{cases}
S(n) + \frac{f_1^2}{2f_2} &amp; \text{if $f_2&gt;0$}\\
S(n) + \frac{f_1(f_1-1)}{2} &amp; \text{otherwise}
\end{cases}
\end{split}\]</div>
<p>The basic idea is to compute the result of the complete test matrix <span class="math notranslate nohighlight">\(T \times M\)</span> of each test against each mutant. The variable <span class="math notranslate nohighlight">\(f_1\)</span> represents the number of mutants that were killed exactly once, and the variable <span class="math notranslate nohighlight">\(f_2\)</span> represents the number of variables that were killed exactly twice. <span class="math notranslate nohighlight">\(S(n)\)</span> is the total number of mutants killed. Here, <span class="math notranslate nohighlight">\(\hat{S}_{Chao1}\)</span> provides the estimate of the true number of mutants. If <span class="math notranslate nohighlight">\(M\)</span> is the total mutants generated, then <span class="math notranslate nohighlight">\(M - \hat{S}_{Chao1}\)</span> represents the number of <strong>immortal</strong> mutants. Note that these <strong>immortal</strong> mutants are somewhat different from the traditional equivalent mutants in that the <strong>mortality</strong> depends on the oracle used to distinguish variant behavior. That is, if one uses a fuzzer that relies on errors thrown to detect killing, it will not detect mutants that produce different output but does not throw an error. Hence, the <em>Chao1</em> estimate will essentially be the asymptote value of mutants the fuzzer can detect if it is given an infinite amount of time. The <strong>immortal</strong> mutant estimate will approach true <strong>equivalent</strong> mutant estimate when the oracle used is sufficiently strong.
For more details see the chapter on <a class="reference internal" href="WhenToStopFuzzing.html"><span class="std std-doc">when to stop fuzzing</span></a>. A comprehensive guide to species discovery in testing is the paper by Boehme \cite{boehme2018species}.</p>
</section>
</section>
<section id="id1">
<h2>Synopsis<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>This chapter introduces two methods of running <em>mutation analysis</em> on subject programs. The first class <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> targets individual functions. Given a function <code class="docutils literal notranslate"><span class="pre">gcd</span></code> and two test cases evaluate, one can run mutation analysis on the test cases as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuFunctionAnalyzer</span><span class="p">(</span><span class="n">gcd</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">mutant</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Minimal&quot;</span>
        <span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Mirror&quot;</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-&gt;	gcd_1
&lt;-	gcd_1
Detected gcd_1 &lt;class &#39;UnboundLocalError&#39;&gt; cannot access local variable &#39;c&#39; where it is not associated with a value

-&gt;	gcd_2
&lt;-	gcd_2
Detected gcd_2 &lt;class &#39;AssertionError&#39;&gt; Mirror

-&gt;	gcd_3
&lt;-	gcd_3

-&gt;	gcd_4
&lt;-	gcd_4

-&gt;	gcd_5
&lt;-	gcd_5

-&gt;	gcd_6
&lt;-	gcd_6

-&gt;	gcd_7
&lt;-	gcd_7
Detected gcd_7 &lt;class &#39;AssertionError&#39;&gt; Minimal
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.42857142857142855
</pre></div>
</div>
</div>
</div>
<p>The second class <code class="docutils literal notranslate"><span class="pre">MuProgramAnalyzer</span></code> targets standalone programs with test suites. Given a program <code class="docutils literal notranslate"><span class="pre">gcd</span></code> whose source code is provided in <code class="docutils literal notranslate"><span class="pre">gcd_src</span></code> and the test suite is provided by <code class="docutils literal notranslate"><span class="pre">TestGCD</span></code>, one can evaluate the mutation score of <code class="docutils literal notranslate"><span class="pre">TestGCD</span></code> as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestGCD</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">test_mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">cfg</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuProgramAnalyzer</span><span class="p">(</span><span class="s1">&#39;gcd&#39;</span><span class="p">,</span> <span class="n">gcd_src</span><span class="p">):</span>
    <span class="n">mutant</span><span class="p">[</span><span class="n">test_module</span><span class="p">]</span><span class="o">.</span><span class="n">runTest</span><span class="p">(</span><span class="s1">&#39;TestGCD&#39;</span><span class="p">)</span>
<span class="n">mutant</span><span class="o">.</span><span class="n">pm</span><span class="o">.</span><span class="n">score</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
======================================================================
FAIL: test_simple (__main__.TestGCD.test_simple)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;/var/folders/n2/xd9445p97rb3xh7m1dfx8_4h0006ts/T/ipykernel_7987/2565918356.py&quot;, line 3, in test_simple
    assert cfg.gcd(1, 0) == 1
           ^^^^^^^^^^^^^^^^^^
AssertionError

----------------------------------------------------------------------
Ran 1 test in 0.000s

FAILED (failures=1)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<p>The mutation score thus obtained is a better indicator of the quality of a given test suite than pure coverage.</p>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>We have learned why structural coverage is insufficient to evaluate the quality of test suites.</p></li>
<li><p>We have learned how to use Mutation Analysis for evaluating test suite quality.</p></li>
<li><p>We have learned the limitations of Mutation Analysis – Equivalent and Redundant mutants, and how to estimate them.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>While naive fuzzing generates poor quality oracles, techniques such as <a class="reference internal" href="SymbolicFuzzer.html"><span class="std std-doc">symbolic</span></a> and <a class="reference internal" href="ConcolicFuzzer.html"><span class="std std-doc">concolic</span></a> can enhance the quality oracles used in fuzzing.</p></li>
<li><p><a class="reference internal" href="DynamicInvariants.html"><span class="std std-doc">Dynamic invariants</span></a> can also be of great help in improving the quality of oracles.</p></li>
<li><p>The chapter on <a class="reference internal" href="WhenToStopFuzzing.html"><span class="std std-doc">when to stop fuzzing</span></a> provides a detailed overview of the Chao estimator.</p></li>
</ul>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The idea of Mutation Analysis was first introduced by Lipton et al. \cite{lipton1971fault}. An excellent survey of mutation analysis research was published by Jia et al. \cite{jia2011analysis}. The chapter on Mutation Analysis by Papadakis et al \cite{papadakis2019mutation} is another excellent overview of the current trends in mutation analysis.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<section id="exercise-1-arithmetic-expression-mutators">
<h3>Exercise 1: Arithmetic Expression Mutators<a class="headerlink" href="#exercise-1-arithmetic-expression-mutators" title="Link to this heading">#</a></h3>
<p>Our simple statement deletion mutation is only one of the ways in which a program could be mutated. Another category of mutants is <em>expression mutation</em> where arithmetic operators such as <code class="docutils literal notranslate"><span class="pre">{+,-,*,/}</span></code> etc. are replaced for one another. For example, given an expression such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>One can mutate it to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">1</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">1</span>
</pre></div>
</div>
<p>First, we need to find out which node types we want to mutate. We get these via the ast functions and find that the node type is named BinOp</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1 + 2 - 3 * 4 / 5&quot;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Module(
    body=[
        Expr(
            value=BinOp(
                left=BinOp(
                    left=Constant(value=1),
                    op=Add(),
                    right=Constant(value=2)),
                op=Sub(),
                right=BinOp(
                    left=BinOp(
                        left=Constant(value=3),
                        op=Mult(),
                        right=Constant(value=4)),
                    op=Div(),
                    right=Constant(value=5))))],
    type_ignores=[])
</pre></div>
</div>
</div>
</div>
<p>To mutate the tree, you thus need to change the <code class="docutils literal notranslate"><span class="pre">op</span></code> attribute (which has one of the values <code class="docutils literal notranslate"><span class="pre">Add</span></code>, <code class="docutils literal notranslate"><span class="pre">Sub</span></code>, <code class="docutils literal notranslate"><span class="pre">Mult</span></code>, and <code class="docutils literal notranslate"><span class="pre">Div</span></code>)</p>
<p><strong>Solution.</strong> First, we need to find out which node types we want to mutate.  We get these via the <code class="docutils literal notranslate"><span class="pre">ast</span></code> functions and find that the node type is named <code class="docutils literal notranslate"><span class="pre">BinOp</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1 + 2 - 3 * 4 / 5&quot;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Module(
    body=[
        Expr(
            value=BinOp(
                left=BinOp(
                    left=Constant(value=1),
                    op=Add(),
                    right=Constant(value=2)),
                op=Sub(),
                right=BinOp(
                    left=BinOp(
                        left=Constant(value=3),
                        op=Mult(),
                        right=Constant(value=4)),
                    op=Div(),
                    right=Constant(value=5))))],
    type_ignores=[])
</pre></div>
</div>
</div>
</div>
<p>To mutate the tree, we need to change the <code class="docutils literal notranslate"><span class="pre">op</span></code> attribute (which has one of the values <code class="docutils literal notranslate"><span class="pre">Add</span></code>, <code class="docutils literal notranslate"><span class="pre">Sub</span></code>, <code class="docutils literal notranslate"><span class="pre">Mult</span></code>, and <code class="docutils literal notranslate"><span class="pre">Div</span></code>).  Write a class <code class="docutils literal notranslate"><span class="pre">BinOpMutator</span></code> that does the necessary mutations, and then create a  class <code class="docutils literal notranslate"><span class="pre">MuBinOpAnalyzer</span></code> as subclass of <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> which makes use of <code class="docutils literal notranslate"><span class="pre">BinOpMutator</span></code>.</p>
<p><strong>Solution.</strong> As with <code class="docutils literal notranslate"><span class="pre">StmtDeletionMutator</span></code>, we have to visit the AST – in this case, all <code class="docutils literal notranslate"><span class="pre">BinOp</span></code> nodes – and make appropriate changes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinOpMutator</span><span class="p">(</span><span class="n">Mutator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">visit_BinOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutable_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BinOpMutator</span><span class="p">(</span><span class="n">BinOpMutator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mutation_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">replacement</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">()):</span> <span class="n">ast</span><span class="o">.</span><span class="n">Sub</span><span class="p">(),</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Sub</span><span class="p">()):</span> <span class="n">ast</span><span class="o">.</span><span class="n">Add</span><span class="p">(),</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Mult</span><span class="p">()):</span> <span class="n">ast</span><span class="o">.</span><span class="n">Div</span><span class="p">(),</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Div</span><span class="p">()):</span> <span class="n">ast</span><span class="o">.</span><span class="n">Mult</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">replacement</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># All other binary operators (and, mod, etc.)</span>

        <span class="k">return</span> <span class="n">node</span>
</pre></div>
</div>
</div>
</div>
<p>We hook this into our own analyzer:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MuBinOpAnalyzer</span><span class="p">(</span><span class="n">MuFunctionAnalyzer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mutator_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">BinOpMutator</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s how it mutates a function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">arith_expr</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">MuBinOpAnalyzer</span><span class="p">(</span><span class="n">arith_expr</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mutant</span><span class="o">.</span><span class="n">diff</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- original

+++ mutant

@@ -1,2 +1,2 @@

 def arith_expr():
-    return 1 + 2 - 3 * 4 / 5
+    return 1 + 2 + 3 * 4 / 5
--- original

+++ mutant

@@ -1,2 +1,2 @@

 def arith_expr():
-    return 1 + 2 - 3 * 4 / 5
+    return 1 - 2 - 3 * 4 / 5
--- original

+++ mutant

@@ -1,2 +1,2 @@

 def arith_expr():
-    return 1 + 2 - 3 * 4 / 5
+    return 1 + 2 - 3 * 4 * 5
--- original

+++ mutant

@@ -1,2 +1,2 @@

 def arith_expr():
-    return 1 + 2 - 3 * 4 / 5
+    return 1 + 2 - 3 / 4 / 5
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-2-optimizing-mutation-analysis">
<h3>Exercise 2: Optimizing Mutation Analysis<a class="headerlink" href="#exercise-2-optimizing-mutation-analysis" title="Link to this heading">#</a></h3>
<p>Our technique for mutation analysis is somewhat inefficient in that we run the tests even on mutants that have mutations in code not covered by the test case. Test cases have no possibility of detecting errors on portions of code they do not cover. Hence, one of the simplest optimizations is to first recover the coverage information from the given test case, and only run the test case on mutants where the mutations lie in the code being covered by the test case. Can you modify the <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> to incorporate recovering coverage as the first step?</p>
<p><strong>Solution.</strong> Left to the astute reader.</p>
</section>
<section id="exercise-3-byte-code-mutator">
<h3>Exercise 3: Byte Code Mutator<a class="headerlink" href="#exercise-3-byte-code-mutator" title="Link to this heading">#</a></h3>
<p>We have seen how to mutate the AST given the source. One of the deficiencies with this approach is that the Python bytecode is targeted by other languages too. In such cases, the source may not be readily converted to a Python AST, and it is desirable to mutate the bytecode instead. Can you implement a bytecode mutator for Python function that mutates the bytecode instead of fetching the source and then mutating it?</p>
<p><strong>Solution.</strong> Left to the astute reader.</p>
</section>
<section id="exercise-4-estimating-residual-defect-density">
<h3>Exercise 4: Estimating Residual Defect Density<a class="headerlink" href="#exercise-4-estimating-residual-defect-density" title="Link to this heading">#</a></h3>
<p>The defect density of a program is the number of defects in a program that that were detected before release divided by the program size. The residual defect density is the percentage of defects that escaped detection. While estimation of the real residual defect density is difficult, mutation analysis can provide an upper bound. The number of mutants that remain undetected is a plausible upper bound on the number of defects that remain within the program. However, this upper bound may be too wide. The reason is that some remaining faults can interact with each other, and if present together, can be detected by the available test suite. Hence, a tighter bound is the number of mutants that can exist <em>together</em> in a given program without being detected by the given test suite. This can be accomplished by starting with the complete set of mutations possible, and applying delta-debugging from <a class="reference internal" href="Reducer.html"><span class="std std-doc">the chapter on reducing</span></a> to determine the minimum number of mutations that need to be removed to make the mutant pass undetected by the test suite. Can you produce a new <code class="docutils literal notranslate"><span class="pre">RDDEstimator</span></code> by extending the <code class="docutils literal notranslate"><span class="pre">MuFunctionAnalyzer</span></code> that estimates the residual defect density upper bound using this technique?</p>
<p><strong>Solution.</strong> Left to the astute reader.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="SearchBasedFuzzer.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Search-Based Fuzzing</p>
      </div>
    </a>
    <a class="right-next"
       href="Grammars.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fuzzing with Grammars</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-structural-coverage-is-not-enough">Why Structural Coverage is Not Enough</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#seeding-artificial-faults-with-mutation-analysis">Seeding Artificial Faults with Mutation Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#structural-coverage-adequacy-by-example">Structural Coverage Adequacy by Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#injecting-artificial-faults">Injecting Artificial Faults</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutating-python-code">Mutating Python Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-simple-mutator-for-functions">A Simple Mutator for Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-mutations">Evaluating Mutations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutator-for-modules-and-test-suites">Mutator for Modules and Test Suites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-equivalent-mutants">The Problem of  Equivalent Mutants</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-estimation-of-number-of-equivalent-mutants">Statistical Estimation of Number of Equivalent Mutants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-estimation-of-the-number-of-immortals-by-chaos-estimator">Statistical Estimation of the Number of Immortals by Chao’s Estimator</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-arithmetic-expression-mutators">Exercise 1: Arithmetic Expression Mutators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-optimizing-mutation-analysis">Exercise 2: Optimizing Mutation Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-byte-code-mutator">Exercise 3: Byte Code Mutator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-4-estimating-residual-defect-density">Exercise 4: Estimating Residual Defect Density</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021-2025 CISPA Helmholtz Center for Information Security (www.cispa.de); © Copyright 2018-2020 Saarland University, authors, and contributors. All Rights Reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>