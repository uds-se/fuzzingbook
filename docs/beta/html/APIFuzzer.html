
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fuzzing APIs &#8212; The Fuzzing Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=42e1b1a5" />
    <link rel="stylesheet" type="text/css" href="_static/mastodon-timeline.css?v=f82c2b23" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'APIFuzzer';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Carving Unit Tests" href="Carver.html" />
    <link rel="prev" title="Testing Configurations" href="ConfigurationFuzzer.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content"><p>This is a beta version of fuzzingbook.org, currently in development. See the <a href="https://fuzzingbook.org/"  style="color:white!important;">classic site</a> for resources.</p></div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/fuzzingbook.png" class="logo__image only-light" alt="The Fuzzing Book - Home"/>
    <script>document.write(`<img src="_static/fuzzingbook.png" class="logo__image only-dark" alt="The Fuzzing Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    The Fuzzing Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Tours.html">Tours through the Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro_Testing.html">Introduction to Software Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Lexical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Fuzzer.html">Fuzzing: Breaking Things with Random Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Coverage.html">Code Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="MutationFuzzer.html">Mutation-Based Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GreyboxFuzzer.html">Greybox Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="SearchBasedFuzzer.html">Search-Based Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="MutationAnalysis.html">Mutation Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Syntactical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Grammars.html">Fuzzing with Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarFuzzer.html">Efficient Grammar Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarCoverageFuzzer.html">Grammar Coverage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parser.html">Parsing Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProbabilisticGrammarFuzzer.html">Probabilistic Grammar Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="GeneratorGrammarFuzzer.html">Fuzzing with Generators</a></li>

<li class="toctree-l1"><a class="reference internal" href="GreyboxGrammarFuzzer.html">Greybox Fuzzing with Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reducer.html">Reducing Failure-Inducing Inputs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Semantical Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FuzzingWithConstraints.html">Fuzzing with Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="GrammarMiner.html">Mining Input Grammars</a></li>
<li class="toctree-l1"><a class="reference internal" href="InformationFlow.html">Tracking Information Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConcolicFuzzer.html">Concolic Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="SymbolicFuzzer.html">Symbolic Fuzzing</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynamicInvariants.html">Mining Function Specifications</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Domain-Specific Fuzzing</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ConfigurationFuzzer.html">Testing Configurations</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Fuzzing APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Carver.html">Carving Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="PythonFuzzer.html">Testing Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="WebFuzzer.html">Testing Web Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUIFuzzer.html">Testing Graphical User Interfaces</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Managing Fuzzing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FuzzingInTheLarge.html">Fuzzing in the Large</a></li>
<li class="toctree-l1"><a class="reference internal" href="WhenToStopFuzzing.html">When To Stop Fuzzing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AcademicPrototyping.html">Academic Prototyping</a></li>
<li class="toctree-l1"><a class="reference internal" href="PrototypingWithPython.html">Prototyping with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExpectError.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timer.html">Timer</a></li>
<li class="toctree-l1"><a class="reference internal" href="Timeout.html">Timeout</a></li>
<li class="toctree-l1"><a class="reference internal" href="ClassDiagram.html">Class Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="RailroadDiagrams.html">Railroad Diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="ControlFlow.html">Control Flow Graph</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About This Book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ReleaseNotes.html">Fuzzingbook Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Importing.html">Using Fuzzingbook Code in your own Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Guide_for_Authors.html">Guide for Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/uds-se/fuzzingbook/master?urlpath=tree/docs/notebooks/APIFuzzer.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/uds-se/fuzzingbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/uds-se/fuzzingbook/issues/new?title=Issue%20on%20page%20%2FAPIFuzzer.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/APIFuzzer.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Fuzzing APIs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fuzzing-a-function">Fuzzing a Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-code">Synthesizing Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-oracles">Synthesizing Oracles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-data">Synthesizing Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integers">Integers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#floats">Floats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strings">Strings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-composite-data">Synthesizing Composite Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lists">Lists</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-deep-arguments">Exercise 1: Deep Arguments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-covering-argument-combinations">Exercise 2: Covering Argument Combinations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-mutating-arguments">Exercise 3: Mutating Arguments</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="fuzzing-apis">
<h1>Fuzzing APIs<a class="headerlink" href="#fuzzing-apis" title="Link to this heading">#</a></h1>
<p>So far, we have always generated <em>system input</em>, i.e. data that the program as a whole obtains via its input channels.  However, we can also generate inputs that go directly into individual functions, gaining flexibility and speed in the process.  In this chapter, we explore the use of grammars to synthesize code for function calls, which allows you to generate <em>program code that very efficiently invokes functions directly.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bookutils</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;CC1VvOGkzm8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="640"
            height="360"
            src="https://www.youtube-nocookie.com/embed/CC1VvOGkzm8"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><p>You have to know how grammar fuzzing work, e.g. from the <a class="reference internal" href="Grammars.html"><span class="std std-doc">chapter on grammars</span></a>.</p></li>
<li><p>We make use of <em>generator functions</em>, as discussed in the <a class="reference internal" href="GeneratorGrammarFuzzer.html"><span class="std std-doc">chapter on fuzzing with generators</span></a>.</p></li>
<li><p>We make use of probabilities, as discussed in the <a class="reference internal" href="ProbabilisticGrammarFuzzer.html"><span class="std std-doc">chapter on fuzzing with probabilities</span></a>.</p></li>
</ul>
<section id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Link to this heading">#</a></h2>
<!-- Automatically generated. Do not edit. -->
<p>To <a class="reference internal" href="Importing.html"><span class="std std-doc">use the code provided in this chapter</span></a>, write</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fuzzingbook.APIFuzzer</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">identifier</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and then make use of the following features.</p>
<p>This chapter provides <em>grammar constructors</em> that are useful for generating <em>function calls</em>.</p>
<p>The grammars are <a class="reference internal" href="ProbabilisticGrammarFuzzer.html"><span class="std std-doc">probabilistic</span></a> and make use of <a class="reference internal" href="GeneratorGrammarFuzzer.html"><span class="std std-doc">generators</span></a>, so use <code class="docutils literal notranslate"><span class="pre">ProbabilisticGeneratorGrammarFuzzer</span></code> as a producer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">GeneratorGrammarFuzzer</span> <span class="kn">import</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">INT_GRAMMAR</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT_GRAMMAR</span></code>, <code class="docutils literal notranslate"><span class="pre">ASCII_STRING_GRAMMAR</span></code> produce integers, floats, and strings, respectively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">INT_GRAMMAR</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="go">[&#39;-51&#39;, &#39;9&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;32&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">FLOAT_GRAMMAR</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="go">[&#39;0e0&#39;,</span>
<span class="go"> &#39;-9.43e34&#39;,</span>
<span class="go"> &#39;-7.3282e0&#39;,</span>
<span class="go"> &#39;-9.5e-9&#39;,</span>
<span class="go"> &#39;0&#39;,</span>
<span class="go"> &#39;-30.840386e-5&#39;,</span>
<span class="go"> &#39;3&#39;,</span>
<span class="go"> &#39;-4.1e0&#39;,</span>
<span class="go"> &#39;-9.7&#39;,</span>
<span class="go"> &#39;413&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">ASCII_STRING_GRAMMAR</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="go">[&#39;&quot;#vYV*t@I%KNTT[q~}&amp;-v+[zAzj[X-z|RzC$(g$Br]1tC\&#39;:5&lt;F-&quot;&#39;,</span>
<span class="go"> &#39;&quot;&quot;&#39;,</span>
<span class="go"> &#39;&quot;^S/&quot;&#39;,</span>
<span class="go"> &#39;&quot;y)QDs_9&quot;&#39;,</span>
<span class="go"> &#39;&quot;)dY~?WYqMh,bwn3\\&quot;A!02Pk`gx&quot;&#39;,</span>
<span class="go"> &#39;&quot;01n|(dd$-d.sx\\&quot;83\\&quot;h/]qx)d9LPNdrk$}$4t3zhC.%3VY@AZZ0wCs2 N&quot;&#39;,</span>
<span class="go"> &#39;&quot;D\\6\\xgw#TQ}$\&#39;3&quot;&#39;,</span>
<span class="go"> &#39;&quot;LaM{&quot;&#39;,</span>
<span class="go"> &#39;&quot;\\&quot;ux\&#39;1H!=%;2T$.=l&quot;&#39;,</span>
<span class="go"> &#39;&quot;=vkiV~w.Ypt,?JwcEr}Moc&gt;!5&lt;U+DdYAup\\&quot;N 0V?h3x~jFN3&quot;&#39;]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">int_grammar_with_range(start,</span> <span class="pre">end)</span></code> produces an integer grammar with values <code class="docutils literal notranslate"><span class="pre">N</span></code> such that <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">&lt;=</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">end</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">int_grammar</span> <span class="o">=</span> <span class="n">int_grammar_with_range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="go">[&#39;154&#39;, &#39;149&#39;, &#39;185&#39;, &#39;117&#39;, &#39;182&#39;, &#39;154&#39;, &#39;131&#39;, &#39;194&#39;, &#39;147&#39;, &#39;192&#39;]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">float_grammar_with_range(start,</span> <span class="pre">end)</span></code> produces a floating-number grammar with values <code class="docutils literal notranslate"><span class="pre">N</span></code> such that <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">&lt;=</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">end</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">float_grammar</span> <span class="o">=</span> <span class="n">float_grammar_with_range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">float_grammar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="go">[&#39;121.8092479227325&#39;,</span>
<span class="go"> &#39;187.18037169119634&#39;,</span>
<span class="go"> &#39;127.9576486784452&#39;,</span>
<span class="go"> &#39;125.47768739781723&#39;,</span>
<span class="go"> &#39;151.8091820472274&#39;,</span>
<span class="go"> &#39;117.864410860742&#39;,</span>
<span class="go"> &#39;187.50918008379483&#39;,</span>
<span class="go"> &#39;119.29335112884749&#39;,</span>
<span class="go"> &#39;149.2637029583114&#39;,</span>
<span class="go"> &#39;126.61818995939146&#39;]</span>
</pre></div>
</div>
<p>All such values can be immediately used for testing function calls:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">call</span> <span class="o">=</span> <span class="s2">&quot;sqrt(&quot;</span> <span class="o">+</span> <span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">call</span>
<span class="go">&#39;sqrt(143)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
<span class="go">11.958260743101398</span>
</pre></div>
</div>
<p>These grammars can also be composed to form more complex grammars. <code class="docutils literal notranslate"><span class="pre">list_grammar(object_grammar)</span></code> returns a grammar that produces lists of objects as defined by <code class="docutils literal notranslate"><span class="pre">object_grammar</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">int_list_grammar</span> <span class="o">=</span> <span class="n">list_grammar</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_list_grammar</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="go">[&#39;[118, 111, 188, 137, 129]&#39;,</span>
<span class="go"> &#39;[170, 172]&#39;,</span>
<span class="go"> &#39;[171, 161, 117, 191, 175, 183, 164]&#39;,</span>
<span class="go"> &#39;[189]&#39;,</span>
<span class="go"> &#39;[129, 110, 178]&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_list</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">some_list</span>
<span class="go">[172, 120, 106, 192, 124, 191, 161, 100, 117]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span>
<span class="go">9</span>
</pre></div>
</div>
<p>In a similar vein, we can construct arbitrary further data types for testing individual functions programmatically.</p>
</section>
<section id="fuzzing-a-function">
<h2>Fuzzing a Function<a class="headerlink" href="#fuzzing-a-function" title="Link to this heading">#</a></h2>
<p>Let us start with our first problem: How do we fuzz a given function?  For an interpreted language like Python, this is pretty straight-forward.  All we need to do is to generate <em>calls</em> to the function(s) we want to test.  This is something we can easily do with a grammar.</p>
<p>As an example, consider the <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code> function from the Python library.  <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code> takes a URL and decomposes it into its individual components.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bookutils.setup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlparse</span><span class="p">(</span><span class="s1">&#39;https://www.fuzzingbook.com/html/APIFuzzer.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ParseResult(scheme=&#39;https&#39;, netloc=&#39;www.fuzzingbook.com&#39;, path=&#39;/html/APIFuzzer.html&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre></div>
</div>
</div>
</div>
<p>You see how the individual elements of the URL – the <em>scheme</em> (<code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code>), the <em>network location</em> (<code class="docutils literal notranslate"><span class="pre">&quot;www.fuzzingbook.com&quot;</span></code>), or the path (<code class="docutils literal notranslate"><span class="pre">&quot;//html/APIFuzzer.html&quot;</span></code>) are all properly identified.  Other elements (like <code class="docutils literal notranslate"><span class="pre">params</span></code>, <code class="docutils literal notranslate"><span class="pre">query</span></code>, or <code class="docutils literal notranslate"><span class="pre">fragment</span></code>) are empty, because they were not part of our input.</p>
<p>To test <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code>, we’d want to feed it a large set of different URLs.  We can obtain these from the URL grammar we had defined in the <a class="reference internal" href="Grammars.html"><span class="std std-doc">“Grammars”</span></a> chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Grammars</span> <span class="kn">import</span> <span class="n">URL_GRAMMAR</span><span class="p">,</span> <span class="n">is_valid_grammar</span><span class="p">,</span> <span class="n">START_SYMBOL</span>
<span class="kn">from</span> <span class="nn">Grammars</span> <span class="kn">import</span> <span class="n">opts</span><span class="p">,</span> <span class="n">extend_grammar</span><span class="p">,</span> <span class="n">Grammar</span>
<span class="kn">from</span> <span class="nn">GrammarFuzzer</span> <span class="kn">import</span> <span class="n">GrammarFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ParseResult(scheme=&#39;https&#39;, netloc=&#39;user:password@cispa.saarland:8080&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;http&#39;, netloc=&#39;cispa.saarland:1&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;https&#39;, netloc=&#39;fuzzingbook.com:7&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;https&#39;, netloc=&#39;user:password@cispa.saarland:80&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftps&#39;, netloc=&#39;user:password@fuzzingbook.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftp&#39;, netloc=&#39;fuzzingbook.com&#39;, path=&#39;/abc&#39;, params=&#39;&#39;, query=&#39;abc=x31&amp;def=x20&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftp&#39;, netloc=&#39;user:password@fuzzingbook.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;https&#39;, netloc=&#39;www.google.com:80&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;http&#39;, netloc=&#39;fuzzingbook.com:52&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
ParseResult(scheme=&#39;ftps&#39;, netloc=&#39;user:password@cispa.saarland&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre></div>
</div>
</div>
</div>
<p>This way, we can easily test any Python function – by setting up a scaffold that runs it.  How would we proceed, though, if we wanted to have a test that can be re-run again and again, without having to generate new calls every time?</p>
</section>
<section id="synthesizing-code">
<h2>Synthesizing Code<a class="headerlink" href="#synthesizing-code" title="Link to this heading">#</a></h2>
<p>The “scaffolding” method, as sketched above, has an important downside: It couples test generation and test execution into a single unit, disallowing running both at different times, or for different languages.  To decouple the two, we take another approach: Rather than generating inputs and immediately feeding this input into a function, we <em>synthesize code</em> instead that invokes functions with a given input.</p>
<p>For instance, if we generate the string</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="o">=</span> <span class="s2">&quot;urlparse(&#39;http://www.cispa.de/&#39;)&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>we can execute this string as a whole (and thus run the test) at any time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.cispa.de&#39;, path=&#39;/&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)
</pre></div>
</div>
</div>
</div>
<p>To systematically generate such calls, we can again use a grammar:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">:</span>
        <span class="p">[</span><span class="s1">&#39;urlparse(&quot;&lt;url&gt;&quot;)&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Import definitions from URL_GRAMMAR</span>
<span class="n">URLPARSE_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
<span class="n">URLPARSE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This grammar creates calls in the form <code class="docutils literal notranslate"><span class="pre">urlparse(&lt;url&gt;)</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;url&gt;</span></code> comes from the “imported” URL grammar.  The idea is to create many of these calls and to feed them into the Python interpreter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_GRAMMAR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;&lt;call&gt;&#39;: [&#39;urlparse(&quot;&lt;url&gt;&quot;)&#39;],
 &#39;&lt;start&gt;&#39;: [&#39;&lt;call&gt;&#39;],
 &#39;&lt;url&gt;&#39;: [&#39;&lt;scheme&gt;://&lt;authority&gt;&lt;path&gt;&lt;query&gt;&#39;],
 &#39;&lt;scheme&gt;&#39;: [&#39;http&#39;, &#39;https&#39;, &#39;ftp&#39;, &#39;ftps&#39;],
 &#39;&lt;authority&gt;&#39;: [&#39;&lt;host&gt;&#39;,
  &#39;&lt;host&gt;:&lt;port&gt;&#39;,
  &#39;&lt;userinfo&gt;@&lt;host&gt;&#39;,
  &#39;&lt;userinfo&gt;@&lt;host&gt;:&lt;port&gt;&#39;],
 &#39;&lt;host&gt;&#39;: [&#39;cispa.saarland&#39;, &#39;www.google.com&#39;, &#39;fuzzingbook.com&#39;],
 &#39;&lt;port&gt;&#39;: [&#39;80&#39;, &#39;8080&#39;, &#39;&lt;nat&gt;&#39;],
 &#39;&lt;nat&gt;&#39;: [&#39;&lt;digit&gt;&#39;, &#39;&lt;digit&gt;&lt;digit&gt;&#39;],
 &#39;&lt;digit&gt;&#39;: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;userinfo&gt;&#39;: [&#39;user:password&#39;],
 &#39;&lt;path&gt;&#39;: [&#39;&#39;, &#39;/&#39;, &#39;/&lt;id&gt;&#39;],
 &#39;&lt;id&gt;&#39;: [&#39;abc&#39;, &#39;def&#39;, &#39;x&lt;digit&gt;&lt;digit&gt;&#39;],
 &#39;&lt;query&gt;&#39;: [&#39;&#39;, &#39;?&lt;params&gt;&#39;],
 &#39;&lt;params&gt;&#39;: [&#39;&lt;param&gt;&#39;, &#39;&lt;param&gt;&amp;&lt;params&gt;&#39;],
 &#39;&lt;param&gt;&#39;: [&#39;&lt;id&gt;=&lt;id&gt;&#39;, &#39;&lt;id&gt;=&lt;nat&gt;&#39;]}
</pre></div>
</div>
</div>
</div>
<p>We can now use this grammar for fuzzing and synthesizing calls to <code class="docutils literal notranslate"><span class="pre">urlparse)</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlparse_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">)</span>
<span class="n">urlparse_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;urlparse(&quot;http://user:password@fuzzingbook.com:8080?abc=x29&quot;)&#39;
</pre></div>
</div>
</div>
</div>
<p>Just as above, we can immediately execute these calls.  To better see what is happening, we define a small helper function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Call function_name(arg[0], arg[1], ...) as a string</span>
<span class="k">def</span> <span class="nf">do_call</span><span class="p">(</span><span class="n">call_string</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">call_string</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">call_string</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">= &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">call</span> <span class="o">=</span> <span class="n">urlparse_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="n">do_call</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>urlparse(&quot;http://www.google.com?abc=def&quot;)
	= ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.google.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;abc=def&#39;, fragment=&#39;&#39;)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ParseResult(scheme=&#39;http&#39;, netloc=&#39;www.google.com&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;abc=def&#39;, fragment=&#39;&#39;)
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code> were a C function, for instance, we could embed its call into some (also generated) C function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;cfile&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;cheader&gt;&lt;cfunction&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;cheader&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;#include &quot;urlparse.h&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;cfunction&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;void test() {</span><span class="se">\n</span><span class="s2">&lt;calls&gt;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;calls&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;calls&gt;&lt;call&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;    urlparse(&quot;&lt;url&gt;&quot;);</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_C_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">URL_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;cfile&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlparse_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_C_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">urlparse_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#include &quot;urlparse.h&quot;

void test() {
    urlparse(&quot;http://user:password@cispa.saarland:99/x69?x57=abc&quot;);
}
</pre></div>
</div>
</div>
</div>
</section>
<section id="synthesizing-oracles">
<h2>Synthesizing Oracles<a class="headerlink" href="#synthesizing-oracles" title="Link to this heading">#</a></h2>
<p>In our <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code> example, both the Python as well as the C variant only check for <em>generic</em> errors in <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code>; that is, they only detect fatal errors and exceptions.  For a full test, we need to set up a specific <em>oracle</em> as well that checks whether the result is valid.</p>
<p>Our plan is to check whether specific parts of the URL reappear in the result – that is, if the scheme is <code class="docutils literal notranslate"><span class="pre">http:</span></code>, then the <code class="docutils literal notranslate"><span class="pre">ParseResult</span></code> returned should also contain a <code class="docutils literal notranslate"><span class="pre">http:</span></code> scheme.  As discussed in the <a class="reference internal" href="GeneratorGrammarFuzzer.html"><span class="std std-doc">chapter on fuzzing with generators</span></a>, equalities of strings such as <code class="docutils literal notranslate"><span class="pre">http:</span></code> across two symbols cannot be expressed in a context-free grammar.  We can, however, use a <em>generator function</em> (also introduced in the <a class="reference internal" href="GeneratorGrammarFuzzer.html"><span class="std std-doc">chapter on fuzzing with generators</span></a>) to automatically enforce such equalities.</p>
<p>Here is an example.  Invoking <code class="docutils literal notranslate"><span class="pre">geturl()</span></code> on a <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code> result should return the URL as originally passed to <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">GeneratorGrammarFuzzer</span> <span class="kn">import</span> <span class="n">GeneratorGrammarFuzzer</span><span class="p">,</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">,</span>
<span class="p">{</span>
     <span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;assert urlparse(&#39;&lt;url&gt;&#39;).geturl() == &#39;&lt;url&gt;&#39;&quot;</span><span class="p">,</span>
                 <span class="n">opts</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="k">lambda</span> <span class="n">url_1</span><span class="p">,</span> <span class="n">url_2</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">url_1</span><span class="p">]))]</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlparse_oracle_fuzzer</span> <span class="o">=</span> <span class="n">GeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">urlparse_oracle_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>assert urlparse(&#39;https://user:password@cispa.saarland/abc?abc=abc&#39;).geturl() == &#39;https://user:password@cispa.saarland/abc?abc=abc&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In a similar way, we can also check individual components of the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">,</span>
<span class="p">{</span>
     <span class="s2">&quot;&lt;call&gt;&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;result = urlparse(&#39;&lt;scheme&gt;://&lt;host&gt;&lt;path&gt;?&lt;params&gt;&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="c1"># + &quot;print(result)\n&quot;</span>
                 <span class="o">+</span> <span class="s2">&quot;assert result.scheme == &#39;&lt;scheme&gt;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="o">+</span> <span class="s2">&quot;assert result.netloc == &#39;&lt;host&gt;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="o">+</span> <span class="s2">&quot;assert result.path == &#39;&lt;path&gt;&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
                 <span class="o">+</span> <span class="s2">&quot;assert result.query == &#39;&lt;params&gt;&#39;&quot;</span><span class="p">,</span>
                 <span class="n">opts</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="k">lambda</span> <span class="n">scheme_1</span><span class="p">,</span> <span class="n">authority_1</span><span class="p">,</span> <span class="n">path_1</span><span class="p">,</span> <span class="n">params_1</span><span class="p">,</span>
                      <span class="n">scheme_2</span><span class="p">,</span> <span class="n">authority_2</span><span class="p">,</span> <span class="n">path_2</span><span class="p">,</span> <span class="n">params_2</span><span class="p">:</span>
                      <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">scheme_1</span><span class="p">,</span> <span class="n">authority_1</span><span class="p">,</span> <span class="n">path_1</span><span class="p">,</span> <span class="n">params_1</span><span class="p">]))]</span>
<span class="p">})</span>

<span class="c1"># Get rid of unused symbols</span>
<span class="k">del</span> <span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;url&gt;&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;query&gt;&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;authority&gt;&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;userinfo&gt;&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;port&gt;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urlparse_oracle_fuzzer</span> <span class="o">=</span> <span class="n">GeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_ORACLE_GRAMMAR</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">urlparse_oracle_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>result = urlparse(&#39;https://www.google.com/?def=18&amp;abc=abc&#39;)
assert result.scheme == &#39;https&#39;
assert result.netloc == &#39;www.google.com&#39;
assert result.path == &#39;/&#39;
assert result.query == &#39;def=18&amp;abc=abc&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exec</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The use of generator functions may feel a bit cumbersome.  Indeed, if we uniquely stick to Python, we could also create a <em>unit test</em> that directly invokes the fuzzer to generate individual parts:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fuzzed_url_element</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">URLPARSE_GRAMMAR</span><span class="p">,</span> <span class="n">start_symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scheme</span> <span class="o">=</span> <span class="n">fuzzed_url_element</span><span class="p">(</span><span class="s2">&quot;&lt;scheme&gt;&quot;</span><span class="p">)</span>
<span class="n">authority</span> <span class="o">=</span> <span class="n">fuzzed_url_element</span><span class="p">(</span><span class="s2">&quot;&lt;authority&gt;&quot;</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">fuzzed_url_element</span><span class="p">(</span><span class="s2">&quot;&lt;path&gt;&quot;</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">fuzzed_url_element</span><span class="p">(</span><span class="s2">&quot;&lt;params&gt;&quot;</span><span class="p">)</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">://</span><span class="si">%s%s</span><span class="s2">?</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># print(result)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">geturl</span><span class="p">()</span> <span class="o">==</span> <span class="n">url</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="n">scheme</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="n">path</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">query</span> <span class="o">==</span> <span class="n">query</span>
</pre></div>
</div>
</div>
</div>
<p>Using such a unit test makes it easier to express oracles.  However, we lose the ability to systematically cover individual URL elements and alternatives as with <a class="reference internal" href="GrammarCoverageFuzzer.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">GrammarCoverageFuzzer</span></code></span></a> as well as the ability to guide generation towards specific elements as with <a class="reference internal" href="ProbabilisticGrammarFuzzer.html"><span class="std std-doc"><code class="docutils literal notranslate"><span class="pre">ProbabilisticGrammarFuzzer</span></code></span></a>.  Furthermore, a grammar allows us to generate tests for arbitrary programming languages and APIs.</p>
</section>
<section id="synthesizing-data">
<h2>Synthesizing Data<a class="headerlink" href="#synthesizing-data" title="Link to this heading">#</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code>, we have used a very specific grammar for creating a very specific argument.  Many functions take basic data types as (some) arguments, though; we therefore define grammars that generate precisely those arguments.  Even better, we can define functions that <em>generate</em> grammars tailored towards our specific needs, returning values in a particular range, for instance.</p>
<section id="integers">
<h3>Integers<a class="headerlink" href="#integers" title="Link to this heading">#</a></h3>
<p>We introduce a simple grammar to produce integers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Grammars</span> <span class="kn">import</span> <span class="n">convert_ebnf_grammar</span><span class="p">,</span> <span class="n">crange</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ProbabilisticGrammarFuzzer</span> <span class="kn">import</span> <span class="n">ProbabilisticGrammarFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">INT_EBNF_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;_int&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;_int&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;(-)?&lt;leaddigit&gt;&lt;digit&gt;*&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;leaddigit&gt;&quot;</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">),</span>
    <span class="s2">&quot;&lt;digit&gt;&quot;</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">INT_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">INT_GRAMMAR</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">INT_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">INT_GRAMMAR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;&lt;start&gt;&#39;: [&#39;&lt;int&gt;&#39;],
 &#39;&lt;int&gt;&#39;: [&#39;&lt;_int&gt;&#39;],
 &#39;&lt;_int&gt;&#39;: [&#39;&lt;symbol-1&gt;&lt;leaddigit&gt;&lt;digit-1&gt;&#39;, &#39;0&#39;],
 &#39;&lt;leaddigit&gt;&#39;: [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;digit&gt;&#39;: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;symbol&gt;&#39;: [&#39;-&#39;],
 &#39;&lt;symbol-1&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol&gt;&#39;],
 &#39;&lt;digit-1&gt;&#39;: [&#39;&#39;, &#39;&lt;digit&gt;&lt;digit-1&gt;&#39;]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int_fuzzer</span> <span class="o">=</span> <span class="n">GrammarFuzzer</span><span class="p">(</span><span class="n">INT_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">int_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;699&#39;, &#39;-44&#39;, &#39;321&#39;, &#39;-7&#39;, &#39;-6&#39;, &#39;67&#39;, &#39;0&#39;, &#39;0&#39;, &#39;57&#39;, &#39;0&#39;]
</pre></div>
</div>
</div>
</div>
<p>If we need integers in a specific range, we can add a generator function that does right that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Grammars</span> <span class="kn">import</span> <span class="n">set_opts</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">int_grammar_with_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">int_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">INT_GRAMMAR</span><span class="p">)</span>
    <span class="n">set_opts</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">,</span> <span class="s2">&quot;&lt;int&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;_int&gt;&quot;</span><span class="p">,</span>
        <span class="n">opts</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">int_grammar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int_fuzzer</span> <span class="o">=</span> <span class="n">GeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_grammar_with_range</span><span class="p">(</span><span class="mi">900</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="p">[</span><span class="n">int_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;942&#39;, &#39;955&#39;, &#39;997&#39;, &#39;967&#39;, &#39;939&#39;, &#39;923&#39;, &#39;984&#39;, &#39;914&#39;, &#39;991&#39;, &#39;982&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="floats">
<h3>Floats<a class="headerlink" href="#floats" title="Link to this heading">#</a></h3>
<p>The grammar for floating-point values closely resembles the integer grammar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FLOAT_EBNF_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;float&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;float&gt;&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;&lt;_float&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)),</span> <span class="s2">&quot;inf&quot;</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;_float&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;int&gt;(.&lt;digit&gt;+)?&lt;exp&gt;?&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;exp&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;e&lt;int&gt;&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">FLOAT_EBNF_GRAMMAR</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">INT_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">FLOAT_EBNF_GRAMMAR</span><span class="p">[</span><span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;float&gt;&quot;</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">FLOAT_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">FLOAT_GRAMMAR</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">FLOAT_EBNF_GRAMMAR</span><span class="p">)</span>
<span class="n">FLOAT_GRAMMAR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;&lt;start&gt;&#39;: [&#39;&lt;float&gt;&#39;],
 &#39;&lt;float&gt;&#39;: [(&#39;&lt;_float&gt;&#39;, {&#39;prob&#39;: 0.9}), &#39;inf&#39;, &#39;NaN&#39;],
 &#39;&lt;_float&gt;&#39;: [&#39;&lt;int&gt;&lt;symbol-2&gt;&lt;exp-1&gt;&#39;],
 &#39;&lt;exp&gt;&#39;: [&#39;e&lt;int&gt;&#39;],
 &#39;&lt;int&gt;&#39;: [&#39;&lt;_int&gt;&#39;],
 &#39;&lt;_int&gt;&#39;: [&#39;&lt;symbol-1-1&gt;&lt;leaddigit&gt;&lt;digit-1&gt;&#39;, &#39;0&#39;],
 &#39;&lt;leaddigit&gt;&#39;: [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;digit&gt;&#39;: [&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;],
 &#39;&lt;symbol&gt;&#39;: [&#39;.&lt;digit-2&gt;&#39;],
 &#39;&lt;symbol-1&gt;&#39;: [&#39;-&#39;],
 &#39;&lt;symbol-2&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol&gt;&#39;],
 &#39;&lt;exp-1&gt;&#39;: [&#39;&#39;, &#39;&lt;exp&gt;&#39;],
 &#39;&lt;symbol-1-1&gt;&#39;: [&#39;&#39;, &#39;&lt;symbol-1&gt;&#39;],
 &#39;&lt;digit-1&gt;&#39;: [&#39;&#39;, &#39;&lt;digit&gt;&lt;digit-1&gt;&#39;],
 &#39;&lt;digit-2&gt;&#39;: [&#39;&lt;digit&gt;&#39;, &#39;&lt;digit&gt;&lt;digit-2&gt;&#39;]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGrammarFuzzer</span><span class="p">(</span><span class="n">FLOAT_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">float_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;0&#39;, &#39;-4e0&#39;, &#39;-3.3&#39;, &#39;0.55e0&#39;, &#39;0e2&#39;, &#39;0.2&#39;, &#39;-48.6e0&#39;, &#39;0.216&#39;, &#39;-4.844&#39;, &#39;-6.100&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">float_grammar_with_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">float_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">FLOAT_GRAMMAR</span><span class="p">)</span>
    <span class="n">set_opts</span><span class="p">(</span><span class="n">float_grammar</span><span class="p">,</span> <span class="s2">&quot;&lt;float&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;_float&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span>
        <span class="n">pre</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">float_grammar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span>
    <span class="n">float_grammar_with_range</span><span class="p">(</span><span class="mf">900.0</span><span class="p">,</span> <span class="mf">900.9</span><span class="p">))</span>
<span class="p">[</span><span class="n">float_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;900.1695968039919&#39;,
 &#39;900.3273891873373&#39;,
 &#39;900.225192820568&#39;,
 &#39;900.3231805358258&#39;,
 &#39;900.4963527393471&#39;,
 &#39;inf&#39;,
 &#39;inf&#39;,
 &#39;900.6037658059212&#39;,
 &#39;900.6212350658716&#39;,
 &#39;900.3877831415683&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Link to this heading">#</a></h3>
<p>Finally, we introduce a grammar for producing strings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ASCII_STRING_EBNF_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;ascii-string&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;ascii-string&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;&quot;&lt;ascii-chars&gt;&quot;&#39;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;ascii-chars&gt;&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)),</span>
        <span class="s2">&quot;&lt;ascii-chars&gt;&lt;ascii-char&gt;&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;&lt;ascii-char&gt;&quot;</span><span class="p">:</span> <span class="n">crange</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;\&quot;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">crange</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;~&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">ASCII_STRING_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ASCII_STRING_GRAMMAR</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">ASCII_STRING_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">string_fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGrammarFuzzer</span><span class="p">(</span><span class="n">ASCII_STRING_GRAMMAR</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">string_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;&quot;BgY)&quot;&#39;, &#39;&quot;j[-64Big65wso(f:wg|}w&amp;*D9JthLX}0@PT^]mr[`69Cq8H713ITYx&lt;#jpml)\\&quot;&quot;&#39;, &#39;&quot;{);XWZJ@d`\&#39;[h#F{1)C9M?%C`=&quot;&#39;, &#39;&quot;Y&quot;&#39;, &#39;&quot;C4gh`?uzJzD~$\\\\&quot;=|j)jj=SrBLIJ@0IbYiwIvNf5#pT4QUR}[g,35?Wg4i?3TdIsR0|eq3r;ZKuyI\&#39;&lt;\\&quot;[p/x$&lt;$B!\\&quot;_&quot;&#39;, &#39;&quot;J0HG33+E(p8JQtKW.;G7 ^?.&quot;&#39;, &#39;&quot;7r^B:Jf*J.@sqfED|M)3,eJ&amp;OD&quot;&#39;, &#39;&quot;c3Hcx^&amp;*~3\\&quot;Jvac}cX&quot;&#39;, &#39;&quot;\&#39;IHBQ:N+U:w(OAFn0pHLzX&quot;&#39;, &#39;&quot;x4agH&gt;H-2{Q|\\kpYF&quot;&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="synthesizing-composite-data">
<h2>Synthesizing Composite Data<a class="headerlink" href="#synthesizing-composite-data" title="Link to this heading">#</a></h2>
<p>From basic data, as discussed above, we can also produce <em>composite data</em> in data structures such as sets or lists.  We illustrate such generation on lists.</p>
<section id="lists">
<h3>Lists<a class="headerlink" href="#lists" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LIST_EBNF_GRAMMAR</span><span class="p">:</span> <span class="n">Grammar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;&lt;start&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&lt;list&gt;&quot;</span><span class="p">],</span>
    <span class="s2">&quot;&lt;list&gt;&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)),</span>
        <span class="s2">&quot;[&lt;list-objects&gt;]&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;&lt;list-objects&gt;&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;&lt;list-object&gt;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">(</span><span class="n">prob</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)),</span>
        <span class="s2">&quot;&lt;list-object&gt;, &lt;list-objects&gt;&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;&lt;list-object&gt;&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">LIST_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LIST_GRAMMAR</span> <span class="o">=</span> <span class="n">convert_ebnf_grammar</span><span class="p">(</span><span class="n">LIST_EBNF_GRAMMAR</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Our list generator takes a grammar that produces objects; it then instantiates a list grammar with the objects from these grammars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">list_grammar</span><span class="p">(</span><span class="n">object_grammar</span><span class="p">,</span> <span class="n">list_object_symbol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">obj_list_grammar</span> <span class="o">=</span> <span class="n">extend_grammar</span><span class="p">(</span><span class="n">LIST_GRAMMAR</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">list_object_symbol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Default: Use the first expansion of &lt;start&gt; as list symbol</span>
        <span class="n">list_object_symbol</span> <span class="o">=</span> <span class="n">object_grammar</span><span class="p">[</span><span class="n">START_SYMBOL</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">obj_list_grammar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">object_grammar</span><span class="p">)</span>
    <span class="n">obj_list_grammar</span><span class="p">[</span><span class="n">START_SYMBOL</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;list&gt;&quot;</span><span class="p">]</span>
    <span class="n">obj_list_grammar</span><span class="p">[</span><span class="s2">&quot;&lt;list-object&gt;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_object_symbol</span><span class="p">]</span>

    <span class="k">assert</span> <span class="n">is_valid_grammar</span><span class="p">(</span><span class="n">obj_list_grammar</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">obj_list_grammar</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int_list_fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGrammarFuzzer</span><span class="p">(</span><span class="n">list_grammar</span><span class="p">(</span><span class="n">INT_GRAMMAR</span><span class="p">))</span>
<span class="p">[</span><span class="n">int_list_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[0, -4, 23, 0, 0, 9, 0, -6067681]&#39;,
 &#39;[-1, -1, 0, -7]&#39;,
 &#39;[-5, 0]&#39;,
 &#39;[1, 0, -628088, -6, -811, 0, 99, 0]&#39;,
 &#39;[-35, -10, 0, 67]&#39;,
 &#39;[-3, 0, -2, 0, 0]&#39;,
 &#39;[0, -267, -78, -733, 0, 0, 0, 0]&#39;,
 &#39;[0, -6, 71, -9]&#39;,
 &#39;[-72, 76, 0, 2]&#39;,
 &#39;[0, 9, 0, 0, -572, 29, 8, 8, 0]&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">string_list_fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGrammarFuzzer</span><span class="p">(</span>
    <span class="n">list_grammar</span><span class="p">(</span><span class="n">ASCII_STRING_GRAMMAR</span><span class="p">))</span>
<span class="p">[</span><span class="n">string_list_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[&quot;gn-A$j&gt;&quot;, &quot;SPX;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;]&#39;,
 &#39;[&quot;_&quot;, &quot;Qp&quot;]&#39;,
 &#39;[&quot;M&quot;, &quot;5\\&quot;`X744&quot;, &quot;b+5fyM!&quot;, &quot;gR`&quot;]&#39;,
 &#39;[&quot;^h&quot;, &quot;8$u&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;]&#39;,
 &#39;[&quot;6X;&quot;, &quot;&quot;, &quot;T1wp%\&#39;t&quot;]&#39;,
 &#39;[&quot;-?Kk&quot;, &quot;@B&quot;, &quot;}&quot;, &quot;&quot;, &quot;&quot;]&#39;,
 &#39;[&quot;FD&lt;mqK&quot;, &quot;)Y4NI3M.&amp;@1/2.p&quot;, &quot;]C#c1}z#+5{7ERA[|&quot;, &quot;EOFM])BEMFcGM.~k&amp;RMj*,:m8^!5*:vv%ci&quot;]&#39;,
 &#39;[&quot;&quot;, &quot;*B.pKI\\&quot;L&quot;, &quot;O)#&lt;Y&quot;, &quot;\\&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;]&#39;,
 &#39;[&quot;g&quot;]&#39;,
 &#39;[&quot;&quot;, &quot;\\JS;~t&quot;, &quot;h)&quot;, &quot;k&quot;, &quot;&quot;, &quot;&quot;]&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_list_fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">list_grammar</span><span class="p">(</span>
    <span class="n">float_grammar_with_range</span><span class="p">(</span><span class="mf">900.0</span><span class="p">,</span> <span class="mf">900.9</span><span class="p">)))</span>
<span class="p">[</span><span class="n">float_list_fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[900.558064701869, 900.6079527708223, 900.1985188111297, 900.5159940886509, 900.1881413629061, 900.4074809145482, 900.8279453113845, 900.1531931708976, 900.2651056125504, inf, 900.828295978669]&#39;,
 &#39;[900.4956935906264, 900.8166792417645, 900.2044872129637]&#39;,
 &#39;[900.6177668624133, 900.793129850367, 900.5024769009476, 900.5874531663001, inf, 900.3476216137291, 900.5680329060473, 900.1524624203945, 900.1157565249836, 900.0943774301732, 900.1589468212459, 900.8563415304703, 900.2871041191156, 900.2469765832253, 900.408183791468]&#39;,
 &#39;[NaN, 900.1152482126347, 900.1139109179966, NaN, 900.0634308730662, 900.1918596242257]&#39;,
 &#39;[900.49418992478]&#39;,
 &#39;[900.6566851795975, NaN, 900.5585085641878, 900.8678799526169, 900.5580757140183]&#39;,
 &#39;[900.6265067760952]&#39;,
 &#39;[900.5271187218734, 900.3413004135587, 900.0362652510535, 900.2938223153569, 900.6584186055829, 900.5394909707123, 900.5119630230411, 900.2024669591465]&#39;,
 &#39;[900.5068304562362, 900.5173419618334, 900.5268996804168, 900.5247314889621, 900.1082421801126, 900.761200730868, 900.100950598924, 900.1424140649187, inf, inf, 900.4546924838603, 900.7025508468811, 900.5147250716594, 900.4943696257178, 900.814107878577, 900.3540228715348, 900.6165673939341, 900.121833279104, 900.8337503512706, 900.0607374037857, 900.2746253938637, 900.2491844866619, 900.7325728031923]&#39;,
 &#39;[900.6962790125643, 900.6055198052603, 900.0950691946015, 900.6283670716376, NaN, 900.112869956762]&#39;]
</pre></div>
</div>
</div>
</div>
<p>Generators for dictionaries, sets, etc. can be defined in a similar fashion.  By plugging together grammar generators, we can produce data structures with arbitrary elements.</p>
</section>
</section>
<section id="id1">
<h2>Synopsis<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>This chapter provides <em>grammar constructors</em> that are useful for generating <em>function calls</em>.</p>
<p>The grammars are <a class="reference internal" href="ProbabilisticGrammarFuzzer.html"><span class="std std-doc">probabilistic</span></a> and make use of <a class="reference internal" href="GeneratorGrammarFuzzer.html"><span class="std std-doc">generators</span></a>, so use <code class="docutils literal notranslate"><span class="pre">ProbabilisticGeneratorGrammarFuzzer</span></code> as a producer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">GeneratorGrammarFuzzer</span> <span class="kn">import</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">INT_GRAMMAR</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT_GRAMMAR</span></code>, <code class="docutils literal notranslate"><span class="pre">ASCII_STRING_GRAMMAR</span></code> produce integers, floats, and strings, respectively:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">INT_GRAMMAR</span><span class="p">)</span>
<span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;-51&#39;, &#39;9&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;32&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">FLOAT_GRAMMAR</span><span class="p">)</span>
<span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;0e0&#39;,
 &#39;-9.43e34&#39;,
 &#39;-7.3282e0&#39;,
 &#39;-9.5e-9&#39;,
 &#39;0&#39;,
 &#39;-30.840386e-5&#39;,
 &#39;3&#39;,
 &#39;-4.1e0&#39;,
 &#39;-9.7&#39;,
 &#39;413&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">ASCII_STRING_GRAMMAR</span><span class="p">)</span>
<span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;&quot;#vYV*t@I%KNTT[q~}&amp;-v+[zAzj[X-z|RzC$(g$Br]1tC\&#39;:5&lt;F-&quot;&#39;,
 &#39;&quot;&quot;&#39;,
 &#39;&quot;^S/&quot;&#39;,
 &#39;&quot;y)QDs_9&quot;&#39;,
 &#39;&quot;)dY~?WYqMh,bwn3\\&quot;A!02Pk`gx&quot;&#39;,
 &#39;&quot;01n|(dd$-d.sx\\&quot;83\\&quot;h/]qx)d9LPNdrk$}$4t3zhC.%3VY@AZZ0wCs2 N&quot;&#39;,
 &#39;&quot;D\\6\\xgw#TQ}$\&#39;3&quot;&#39;,
 &#39;&quot;LaM{&quot;&#39;,
 &#39;&quot;\\&quot;ux\&#39;1H!=%;2T$.=l&quot;&#39;,
 &#39;&quot;=vkiV~w.Ypt,?JwcEr}Moc&gt;!5&lt;U+DdYAup\\&quot;N 0V?h3x~jFN3&quot;&#39;]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">int_grammar_with_range(start,</span> <span class="pre">end)</span></code> produces an integer grammar with values <code class="docutils literal notranslate"><span class="pre">N</span></code> such that <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">&lt;=</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">end</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int_grammar</span> <span class="o">=</span> <span class="n">int_grammar_with_range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">)</span>
<span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;154&#39;, &#39;149&#39;, &#39;185&#39;, &#39;117&#39;, &#39;182&#39;, &#39;154&#39;, &#39;131&#39;, &#39;194&#39;, &#39;147&#39;, &#39;192&#39;]
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">float_grammar_with_range(start,</span> <span class="pre">end)</span></code> produces a floating-number grammar with values <code class="docutils literal notranslate"><span class="pre">N</span></code> such that <code class="docutils literal notranslate"><span class="pre">start</span> <span class="pre">&lt;=</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">end</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_grammar</span> <span class="o">=</span> <span class="n">float_grammar_with_range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">float_grammar</span><span class="p">)</span>
<span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;121.8092479227325&#39;,
 &#39;187.18037169119634&#39;,
 &#39;127.9576486784452&#39;,
 &#39;125.47768739781723&#39;,
 &#39;151.8091820472274&#39;,
 &#39;117.864410860742&#39;,
 &#39;187.50918008379483&#39;,
 &#39;119.29335112884749&#39;,
 &#39;149.2637029583114&#39;,
 &#39;126.61818995939146&#39;]
</pre></div>
</div>
</div>
</div>
<p>All such values can be immediately used for testing function calls:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">)</span>
<span class="n">call</span> <span class="o">=</span> <span class="s2">&quot;sqrt(&quot;</span> <span class="o">+</span> <span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
<span class="n">call</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;sqrt(143)&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">eval</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11.958260743101398
</pre></div>
</div>
</div>
</div>
<p>These grammars can also be composed to form more complex grammars. <code class="docutils literal notranslate"><span class="pre">list_grammar(object_grammar)</span></code> returns a grammar that produces lists of objects as defined by <code class="docutils literal notranslate"><span class="pre">object_grammar</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int_list_grammar</span> <span class="o">=</span> <span class="n">list_grammar</span><span class="p">(</span><span class="n">int_grammar</span><span class="p">)</span>
<span class="n">fuzzer</span> <span class="o">=</span> <span class="n">ProbabilisticGeneratorGrammarFuzzer</span><span class="p">(</span><span class="n">int_list_grammar</span><span class="p">)</span>
<span class="p">[</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;[118, 111, 188, 137, 129]&#39;,
 &#39;[170, 172]&#39;,
 &#39;[171, 161, 117, 191, 175, 183, 164]&#39;,
 &#39;[189]&#39;,
 &#39;[129, 110, 178]&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_list</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">fuzzer</span><span class="o">.</span><span class="n">fuzz</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">some_list</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[172, 120, 106, 192, 124, 191, 161, 100, 117]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9
</pre></div>
</div>
</div>
</div>
<p>In a similar vein, we can construct arbitrary further data types for testing individual functions programmatically.</p>
</section>
<section id="lessons-learned">
<h2>Lessons Learned<a class="headerlink" href="#lessons-learned" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>To fuzz individual functions, one can easily set up grammars that produce function calls.</p></li>
<li><p>Fuzzing at the API level can be much faster than fuzzing at the system level, but brings the risk of false alarms by violating implicit preconditions.</p></li>
</ul>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>This chapter was all about manually writing test and controlling which data gets generated.  <a class="reference internal" href="Carver.html"><span class="std std-doc">In the next chapter</span></a>, we will introduce a much higher level of automation:</p>
<ul class="simple">
<li><p><em>Carving</em> automatically records function calls and arguments from program executions.</p></li>
<li><p>We can turn these into <em>grammars</em>, allowing to test these functions with various combinations of recorded values.</p></li>
</ul>
<p>With these techniques, we automatically obtain grammars that already invoke functions in application contexts, making our work of specifying them much easier.</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The idea of using generator functions to generate input structures was first explored in QuickCheck \cite{Claessen2000}.   A very nice implementation for Python is the <a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/">hypothesis package</a> which allows writing and combining data structure generators for testing APIs.</p>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Link to this heading">#</a></h2>
<p>The exercises for this chapter combine the above techniques with fuzzing techniques introduced earlier.</p>
<section id="exercise-1-deep-arguments">
<h3>Exercise 1: Deep Arguments<a class="headerlink" href="#exercise-1-deep-arguments" title="Link to this heading">#</a></h3>
<p>In the example generating oracles for <code class="docutils literal notranslate"><span class="pre">urlparse()</span></code>, important elements such as <code class="docutils literal notranslate"><span class="pre">authority</span></code> or <code class="docutils literal notranslate"><span class="pre">port</span></code> are not checked.  Enrich <code class="docutils literal notranslate"><span class="pre">URLPARSE_ORACLE_GRAMMAR</span></code> with post-expansion functions that store the generated elements in a symbol table, such that they can be accessed when generating the assertions.</p>
<p><strong>Solution.</strong> Left to the reader.</p>
</section>
<section id="exercise-2-covering-argument-combinations">
<h3>Exercise 2: Covering Argument Combinations<a class="headerlink" href="#exercise-2-covering-argument-combinations" title="Link to this heading">#</a></h3>
<p>In the chapter on <a class="reference internal" href="ConfigurationFuzzer.html"><span class="std std-doc">configuration testing</span></a>, we also discussed <em>combinatorial testing</em> – that is, systematic coverage of <em>sets</em> of configuration elements.  Implement a scheme that by changing the grammar, allows all <em>pairs</em> of argument values to be covered.</p>
<p><strong>Solution.</strong> Left to the reader.</p>
</section>
<section id="exercise-3-mutating-arguments">
<h3>Exercise 3: Mutating Arguments<a class="headerlink" href="#exercise-3-mutating-arguments" title="Link to this heading">#</a></h3>
<p>To widen the range of arguments to be used during testing, apply the <em>mutation schemes</em> introduced in <a class="reference internal" href="MutationFuzzer.html"><span class="std std-doc">mutation fuzzing</span></a> – for instance, flip individual bytes or delete characters from strings.  Apply this either during grammar inference or as a separate step when invoking functions.</p>
<p><strong>Solution.</strong> Left to the reader.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ConfigurationFuzzer.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Testing Configurations</p>
      </div>
    </a>
    <a class="right-next"
       href="Carver.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Carving Unit Tests</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synopsis">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fuzzing-a-function">Fuzzing a Function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-code">Synthesizing Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-oracles">Synthesizing Oracles</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-data">Synthesizing Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integers">Integers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#floats">Floats</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#strings">Strings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synthesizing-composite-data">Synthesizing Composite Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lists">Lists</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Synopsis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lessons-learned">Lessons Learned</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-deep-arguments">Exercise 1: Deep Arguments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-covering-argument-combinations">Exercise 2: Covering Argument Combinations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-mutating-arguments">Exercise 3: Mutating Arguments</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andreas Zeller, Rahul Gopinath, Marcel Böhme, Gordon Fraser, and Christian Holler
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021-2025 CISPA Helmholtz Center for Information Security (www.cispa.de); © Copyright 2018-2020 Saarland University, authors, and contributors. All Rights Reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>